ISQ.WebForms=initializeNS("ISQ.WebForms");ISQ.WebForms.PreviewContact=ISQ.Base.extend({name:"ISQ.WebForms.PreviewContact"});ISQ.WebForms.enumInputTypes={Textbox:1,Selectbox:2,Container:3,Checkbox:4,RadioList:5,CheckboxList:6,LabelItem:7,AutoButtons:8,fileUpload:9};ISQ.WebForms.mTextboxType=[{html:"General",value:0,mandatory:false,multiLine:false,maxLength:250},{html:"Email",value:1,mandatory:true,multiLine:false,maxLength:100},{html:"Phone",value:2,mandatory:false,multiLine:false,maxLength:100},{html:"Number",value:3,mandatory:false,multiLine:false,maxLength:100},{html:"Subject",value:4,mandatory:true,multiLine:false,maxLength:250},{html:"Comments",value:5,mandatory:false,multiLine:true,maxLength:2000},{html:"Message",value:6,mandatory:false,multiLine:true,maxLength:2000},{html:"Custom",value:7,mandatory:false,multiLine:false,hasRegex:true,maxLength:2000},{html:"Name",value:8,mandatory:true,multiLine:false,maxLength:100}];ISQ.WebForms.enumSelectTypes={general:ISQ.WebForms.mTextboxType[0],email:ISQ.WebForms.mTextboxType[1],phone:ISQ.WebForms.mTextboxType[2],number:ISQ.WebForms.mTextboxType[3],subject:ISQ.WebForms.mTextboxType[4],comments:ISQ.WebForms.mTextboxType[5],message:ISQ.WebForms.mTextboxType[6],custom:ISQ.WebForms.mTextboxType[7],name:ISQ.WebForms.mTextboxType[8]};ISQ.WebForms.mLayouts=[{layoutWithLabels:false,editorCSS:"/common/contactform/layout0.css",CSSidentifier:"BODY.WEBFORMS_STYLE0",PreviewCSSidentifier:"BODYPREVIEW0",layoutColspan:1,CSS:"/common/contactform/layout0preview.css",thumbnail:"/common/contactform/layout0.jpg"},{layoutWithLabels:false,editorCSS:"/common/contactform/layout1.css",CSSidentifier:"BODY.WEBFORMS_STYLE1",PreviewCSSidentifier:"BODYPREVIEW1",layoutColspan:1,CSS:"/common/contactform/layout1preview.css",thumbnail:"/common/contactform/layout1.jpg",rtlCSS:"/common/contactform/layout1previewrtl.css",CSSRTLidentifier:"BODY.WEBFORMS_RTLCUSTOM1"},{layoutWithLabels:true,editorCSS:"/common/contactform/layout2.css",CSSidentifier:"BODY.WEBFORMS_STYLE2",PreviewCSSidentifier:"BODYPREVIEW2",layoutColspan:1,CSS:"/common/contactform/layout2preview.css",thumbnail:"/common/contactform/layout2.jpg"},{layoutWithLabels:true,editorCSS:"/common/contactform/layout3.css",CSSidentifier:"BODY.WEBFORMS_STYLE3",PreviewCSSidentifier:"BODYPREVIEW3",layoutColspan:1,CSS:"/common/contactform/layout3preview.css",thumbnail:"/common/contactform/layout3.jpg"},{layoutWithLabels:false,editorCSS:"/common/contactform/layout4.css",CSSidentifier:"BODY.WEBFORMS_STYLE4",PreviewCSSidentifier:"BODYPREVIEW4",layoutColspan:1,CSS:"/common/contactform/layout4preview.css",thumbnail:"/common/contactform/layout4.jpg",rtlCSS:"/common/contactform/layoutIconspreviewrtl4.css",CSSRTLidentifier:"BODY.WEBFORMS_RTLCUSTOMICONS4"},{layoutWithLabels:false,editorCSS:"/common/contactform/layout5.css",CSSidentifier:"BODY.WEBFORMS_STYLE5",PreviewCSSidentifier:"BODYPREVIEW5",layoutColspan:1,CSS:"/common/contactform/layout5preview.css",thumbnail:"/common/contactform/layout5.jpg",rtlCSS:"/common/contactform/layoutIconspreviewrtl5.css",CSSRTLidentifier:"BODY.WEBFORMS_RTLCUSTOMICONS5"},{layoutWithLabels:true,editorCSS:"/common/contactform/layout6.css",CSSidentifier:"BODY.WEBFORMS_STYLE6",PreviewCSSidentifier:"BODYPREVIEW6",layoutColspan:2,CSS:"/common/contactform/layout4preview.css",thumbnail:"/common/contactform/layout6.jpg"}];
ISQ.WebForms.PreviewContact.prototype.previewContainer=null;ISQ.WebForms.PreviewContact.prototype.mGuiItems;ISQ.WebForms.PreviewContact.prototype.layout;ISQ.WebForms.PreviewContact.prototype.layoutCols;ISQ.WebForms.PreviewContact.prototype.mTableBody;ISQ.WebForms.PreviewContact.prototype.minSubjectLength;ISQ.WebForms.PreviewContact.prototype.doNothing=function(){};ISQ.WebForms.PreviewContact.prototype.formSerialize;ISQ.WebForms.PreviewContact.prototype.hSubmit;ISQ.WebForms.PreviewContact.prototype.hCancel;ISQ.WebForms.PreviewContact.prototype.hCSSloader;ISQ.WebForms.PreviewContact.prototype.mInputsIndentifier=1;ISQ.WebForms.PreviewContact.predefinedValues=[];ISQ.WebForms.PreviewContact.prototype.predefinedSubject=null;ISQ.WebForms.PreviewContact.prototype.allowedFileExtensions=null;ISQ.WebForms.PreviewContact.prototype.deSerialize;ISQ.WebForms.PreviewContact.prototype.ctor=function(b){this.dependencyExecuter=[];if(b.container){while(b.container.childNodes.length>0){b.container.removeChild(b.container.childNodes[0])}var a=createElement("div");a.setAttribute("id","ContactformInnerContainer");a.style.cssText="max-width:545px;";b.container.appendChild(a);this.previewContainer=a}else{this.previewContainer=null}this.hSubmit=b.hSubmit;this.hCancel=b.hCancel;if(b.hCSS){this.hCSSloader=b.hCSS}if(b.allowedFileExtensions){this.allowedFileExtensions=b.allowedFileExtensions}else{this.allowedFileExtensions=""}};ISQ.WebForms.PreviewContact.prototype.dtor=function(){if(this.formSerialize){for(var b=0;b<this.formSerialize.length;b++){ISQ.CSS.removeStyle("CFP_cssItem"+this.formSerialize[b].id)}}if(this.fileUploadObjects){for(var b=0;b<this.fileUploadObjects.length;b++){var a=this.fileUploadObjects[b].fileUploader;a.dispose()}}this.previewContainer.parentNode.removeChild(this.previewContainer)};ISQ.WebForms.PreviewContact.mobilePredefinedValues={};ISQ.WebForms.PreviewContact.populateMobileValues=true;ISQ.WebForms.PreviewContact.dependencyExecuter=[];ISQ.WebForms.PreviewContact.prototype.sessionEnded=function(){for(var a=0;a<this.fileUploadObjects.length;
a++){this.fileUploadObjects[a].fileUploader.clearAttachments()}};ISQ.WebForms.PreviewContact.incomingPreDefinedValuesFromMessage=function(a){var d=a.split(ISQ.Widget.APIKeyEndDelimiter);var c;for(var b=0;b<d.length;++b){c=d[b].split("(");if(c.length===3){ISQ.WebForms.PreviewContact.reportPreDefinedValue(ISQ.Http.Cookies.decode64(c[0]),ISQ.Http.Cookies.decode64(c[1]),ISQ.Http.Cookies.decode64(c[2]))}else{ISQ.WebForms.PreviewContact.reportPreDefinedValue(ISQ.Http.Cookies.decode64(c[0]),ISQ.Http.Cookies.decode64(c[1]))}}if(ISQ.Widget.ContactForm.preview){ISQ.Widget.ContactForm.preview.populateValues(ISQ.WebForms.PreviewContact.mobilePredefinedValues,_query(true,false))}};ISQ.WebForms.PreviewContact.reportPreDefinedValue=function(a,c,b){b=b||"text";ISQ.WebForms.PreviewContact.mobilePredefinedValues[a]=new ISQ.WebForms.PreviewContact.preDefinedValue(a,c,b)};ISQ.WebForms.PreviewContact.preDefinedValue=function(a,c,b){this.name=a;this.value=c;this.type=b};ISQ.WebForms.PreviewContact.prototype.populateValues=function(c,f){var e=0;for(key in ISQ.WebForms.PreviewContact.mobilePredefinedValues){e++}if(e>0&&ISQ.WebForms.PreviewContact.populateMobileValues){ISQ.WebForms.PreviewContact.populateMobileValues=false;this.populateValues(ISQ.WebForms.PreviewContact.mobilePredefinedValues,f);return}ISQ.WebForms.PreviewContact.populateMobileValues=true;var b=this.formSerialize;ISQ.WebForms.PreviewContact.predefinedValues=[];for(var d=0;d<b.length;d++){if(b[d].it!=ISQ.WebForms.enumInputTypes.Textbox){continue}if(b[d].ti==ISQ.WebForms.enumSelectTypes.subject.value){for(key in c){var a=key.toLowerCase();if((a==b[d]["in"]&&a==b[d]["in"].toLowerCase())||a=="subject"){f=c[key].value;c[key].found=true}}this.populateTextField(d,f)}else{if(b[d].ti==ISQ.WebForms.enumSelectTypes.email.value){for(key in c){var a=key.toLowerCase();if((a==b[d]["in"]&&a==b[d]["in"].toLowerCase())||a=="email_address"||a=="email"){this.populateTextField(d,c[key].value);c[key].found=true}}}else{if(b[d].ti==ISQ.WebForms.enumSelectTypes.comments.value||b[d].ti==ISQ.WebForms.enumSelectTypes.message.value){for(key in c){var a=key.toLowerCase();
if((b[d]["in"]&&a==b[d]["in"].toLowerCase())||a=="message_body"||a=="messagebody"||a=="body"||a=="message"){this.populateTextField(d,c[key].value);c[key].found=true}}}else{for(key in c){if(b[d]["in"]&&key.toLowerCase()==b[d]["in"].toLowerCase()){this.populateTextField(d,c[key].value);c[key].found=true}}}}}}for(key in c){if(!c[key].found){ISQ.WebForms.PreviewContact.predefinedValues.push({name:key,value:c[key].value,type:c[key].type})}}};ISQ.WebForms.PreviewContact.prototype.populateTextField=function(a,c){var b=this.mGuiItems[a].getElementsByTagName("INPUT")[0];if(b){b.value=c}else{var b=this.mGuiItems[a].getElementsByTagName("TEXTAREA")[0];b.value=c}if(b.autoCheck){b.autoCheck()}};ISQ.WebForms.PreviewContact.prototype.loadPreviewCSS=function(a){var d=this;var b=true;for(var c=1;c<ISQ.WebForms.mLayouts.length;c++){if(!ISQ.CSS.toggleCss(ISQ.WebForms.mLayouts[c].PreviewCSSidentifier,false)&&c==a){b=false;ISQ.Tools.FileLoader.load(ISQ.WebForms.mLayouts[c].CSS,new ISQ.Handler(function(e){ISQ.CSS.toggleCss(ISQ.WebForms.mLayouts[e].PreviewCSSidentifier,true);if(d.hCSSloader){d.hCSSloader.handle({doScrollTop:true})}d.loadRTL(ISQ.Tools.isLanguageRTL(d.languageCode),a);if(!ISQ.Tools.isLanguageRTL(d.languageCode)){d.loadPreviewRTLCSS(-1)}}),c)}}ISQ.CSS.toggleCss(ISQ.WebForms.mLayouts[a].PreviewCSSidentifier,true);if(b){d.loadRTL(ISQ.Tools.isLanguageRTL(d.languageCode),a);if(!ISQ.Tools.isLanguageRTL(d.languageCode)){d.loadPreviewRTLCSS(-1)}}if(b&&d.hCSSloader){d.hCSSloader.handle({doScrollTop:true})}};ISQ.WebForms.PreviewContact.prototype.loadPreviewRTLCSS=function(a){var c=this;for(var b=1;b<ISQ.WebForms.mLayouts.length;b++){if(!ISQ.WebForms.mLayouts[b].CSSRTLidentifier){continue}if(!ISQ.CSS.toggleCss(ISQ.WebForms.mLayouts[b].CSSRTLidentifier,false)&&b==a){a=-1;ISQ.Tools.FileLoader.load(ISQ.WebForms.mLayouts[b].rtlCSS,new ISQ.Handler(function(d){ISQ.CSS.toggleCss(ISQ.WebForms.mLayouts[d].CSSRTLidentifier,true);ISQ.CSS.bringToFront(ISQ.WebForms.mLayouts[d].CSSRTLidentifier)}),b)}}if(a!=-1){ISQ.CSS.toggleCss(ISQ.WebForms.mLayouts[a].CSSRTLidentifier,true);
ISQ.CSS.bringToFront(ISQ.WebForms.mLayouts[a].CSSRTLidentifier)}};ISQ.WebForms.PreviewContact.prototype.unloadCSS=function(){for(var a=1;a<ISQ.WebForms.mLayouts.length;a++){ISQ.CSS.toggleCss(ISQ.WebForms.mLayouts[a].PreviewCSSidentifier,false)}};ISQ.WebForms.PreviewContact.prototype.loadRTL=function(c,a){var b=a;var d=this;if(!ISQ.CSS.toggleCss("BODY.WEBFORMS_RTL",c)&&c){ISQ.Tools.FileLoader.load("/common/contactform/rtlsettings.css",new ISQ.Handler(function(e){d.loadPreviewRTLCSS(b)}),i)}else{if(c){ISQ.CSS.bringToFront("BODY.WEBFORMS_RTL");d.loadPreviewRTLCSS(b)}}};ISQ.WebForms.PreviewContact.prototype.getTabIdx=function(){ISQ.WebForms.PreviewContact.tabIndex++;return ISQ.WebForms.PreviewContact.tabIndex};ISQ.WebForms.PreviewContact.prototype.show=function(deSerialize){ISQ.WebForms.PreviewContact.tabIndex=4;var generalSettings=eval("("+deSerialize+")");if(ISQ.Http.browser.isIE7&&generalSettings.settings.layout){generalSettings.settings.layout=3}var mThis=this;this.languageCode=generalSettings.settings.language;this.previewContainer.innerHTML="";this.mGuiItems=[];this.hiddenFields=generalSettings.settings.hiddenFields;this.fileUploadObjects=[];this.layout=generalSettings.settings.layout;this.layoutCols=ISQ.WebForms.mLayouts[this.layout].layoutColspan;this.layoutWithLabels=ISQ.WebForms.mLayouts[this.layout].layoutWithLabels;this.minSubjectLength=generalSettings.settings.minSubjectLength;var formSerialize=generalSettings.fields;var newelement,inputClass;this.mPostUrl=(generalSettings.settings.PostUrl)?generalSettings.settings.PostUrl:null;this.mRedirectParam=(generalSettings.settings.redirectParam)?generalSettings.settings.redirectParam:null;for(var i=0;i<formSerialize.length;i++){if(formSerialize[i]["do"]){formSerialize[i].visible=false}else{formSerialize[i].visible=true}}this.formSerialize=formSerialize;for(var i=0;i<formSerialize.length;i++){var obj;var skipStyle=false;if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.Textbox){obj=this.createContactTextBox(formSerialize[i],i)}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.fileUpload){obj=this.createContactFileUpload(formSerialize[i],i)
}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.Selectbox){obj=this.createContactSelectBox(formSerialize[i],i)}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.RadioList){obj=this.createContactRadio(formSerialize[i],i)}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.CheckboxList){obj=this.createContactCheckbox(formSerialize[i],i)}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.LabelItem){obj=this.createLabel(formSerialize[i],i)}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.AutoButtons){obj=this.createSubmitButtons(formSerialize[i],i);skipStyle=true}}}}}}}if(this.layoutCols!=2){if(formSerialize[i]["do"]){obj.style.display="none"}}obj.setAttribute("id","CF_guiID"+formSerialize[i].id);if(!skipStyle){this.setStyle(formSerialize[i],obj)}this.mGuiItems.push(obj);skipStyle=false}if(this.layoutCols==2){this.generateTable(formSerialize)}for(var i=0;i<formSerialize.length;i++){if(formSerialize[i].db){var controller=this.mGuiItems[i];if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.Selectbox){var selectElement=controller.getElementsByTagName("SELECT");if(selectElement.length!=0){this.activateSelect(selectElement[0],formSerialize[i].db)}}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.RadioList){var inputElements=controller.getElementsByTagName("INPUT");if(inputElements.length!=0){this.activateRadios(inputElements,formSerialize[i].db)}}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.CheckboxList){var inputElements=controller.getElementsByTagName("INPUT");if(inputElements.length!=0){this.activateInputs(inputElements,formSerialize[i].db)}}}}}else{if(formSerialize[i].it==ISQ.WebForms.enumInputTypes.AutoButtons){this.createValidation(this.mGuiItems[i].getElementsByTagName("INPUT")[0],formSerialize);this.mGuiItems[i].getElementsByTagName("INPUT")[1].onclick=function(){if(mThis.hCancel){mThis.hCancel.handle()}}}}}this.loadPreviewCSS(generalSettings.settings.layout);for(var i=0;i<this.dependencyExecuter.length;i++){this.dependencyExecuter[i].execute()}};ISQ.WebForms.PreviewContact.prototype.buildCells=function(b,a,c){var d=this.mTableBody;
var f=null;if(d.rows.length==0){f=createRow(d,"","middle")}else{f=d.rows[d.rows.length-1]}if((f.cells.length==2)||((f.cells.length==1)&&(a==2))||((f.cells.length==1)&&(b==0))||((f.cells.length==1)&&(f.cells[0].getAttribute("colspan")==2))){f=createRow(d,"","middle")}var e=createTd(f,"center","top","width:50%;",null);if((b==1)&&(e.cellIndex==0)){e=createTd(f,"center","top","width:50%;",null)}if(a==2){e.setAttribute("colspan","2");e.style.width="100%"}e.appendChild(c)};ISQ.WebForms.PreviewContact.prototype.generateTable=function(b){this.previewContainer.innerHTML="";this.mTableBody=createTable(this.previewContainer,"100%","ltr","border:0px","left");var f=[];var e=0;for(var d=0;d<this.mGuiItems.length;d++){if(b[d].visible){if(b[d].sp==1){f.push({index:d,"float":e});e=(e==0)?1:0}if(b[d].sp==2){f.push({index:d,"float":2});e=0}}else{if(b[d].sp!=2){e=(e==0)?1:0}}}var a=null;var c=false;for(var d=0;d<f.length;d++){if((f[d]["float"]==0)&&(c==false)){c=true}else{if((f[d]["float"]==1)&&(c==false)){for(var h=d;h<f.length;h++){if(f[h]["float"]==2){break}if(f[h]["float"]==0){var g=f[h];f.splice(h,1);f.splice(d,0,g);d--;break}}}else{if((f[d]["float"]==0)&&(c==true)){for(var h=d;h<f.length;h++){if(f[h]["float"]==2){break}if(f[h]["float"]==1){var g=f[h];f.splice(h,1);f.splice(d,0,g);d--;break}}}else{c=false}}}}for(var d=0;d<f.length;d++){this.buildCells(f[d]["float"],b[f[d].index].sp,this.mGuiItems[f[d].index])}};ISQ.WebForms.PreviewContact.prototype.handleValidationResult=function(h,c,l,a,m,d){var e="";var b="";switch(h){case"textbox":e=c.value;b=e;break;case"select":e=c.selectedIndex;b=0;break;case"checkbox":case"radio":e=c.checked;b=false;if(!l){m=true}break}var j=d.getElementsByTagName("label");var f=0;for(var k=0;k<j.length;k++){if(j[k].className=="CF_labelError"){f++}}if((!m&&l)||(!l&&e!=b&&!m)){if(d&&f==0){var g=createElement("label");g.className="CF_labelError";g.innerHTML=a;g.setAttribute("role","alert");d.appendChild(g)}else{for(var k=0;k<j.length;k++){if(j[k].className=="CF_labelError"){j[k].innerHTML=a}}}return false}if(d){for(var k=0;
k<j.length;k++){if(j[k].className=="CF_labelError"){j[k].parentNode.removeChild(j[k])}}}return true};ISQ.WebForms.PreviewContact.prototype.regexVerification=function(b,a){pattern=new RegExp(a);return(pattern.test(b))};ISQ.WebForms.PreviewContact.searchAnim=null;ISQ.WebForms.PreviewContact.prototype.createValidation=function(d,b){var c=this;var a=createDiv(null,".searchAnim");ISQ.WebForms.PreviewContact.searchAnim=new ISQ.GUI.ProgressAnimation({container:a,onShow:function(){},onHide:function(){}});d.parentNode.insertBefore(a,d);ISQ.WebForms.PreviewContact.searchAnim.hide();d.onclick=function(){ISQ.WebForms.PreviewContact.searchAnim.show();this.style.display="none";var j=[];var v=true;for(var k=0;k<b.length;k++){if(b[k].it==ISQ.WebForms.enumInputTypes.LabelItem){continue}if(b[k].it==ISQ.WebForms.enumInputTypes.AutoButtons){continue}if(b[k].it==ISQ.WebForms.enumInputTypes.Container){continue}var f="";switch(b[k].it){case ISQ.WebForms.enumInputTypes.Textbox:var m=c.mGuiItems[k].getElementsByTagName("INPUT")[0];if(c.mGuiItems[k].style.display!="none"){var w=null;switch(b[k].ti){case ISQ.WebForms.enumSelectTypes.subject.value:var r=m.value.replace(/^\s+|\s+$/g,"");r=r.split(" ");var q=r.length;if(q==1&&r[0]==""){w=false}else{w=(q>=c.minSubjectLength)}break;case ISQ.WebForms.enumSelectTypes.email.value:m.value=m.value.Trim();w=ISQ.Data.checkString(m.value,"email")&&(m.value);break;case ISQ.WebForms.enumSelectTypes.number.value:m.value=m.value.Trim();w=ISQ.Data.checkString(m.value,"number")&&(m.value);break;case ISQ.WebForms.enumSelectTypes.phone.value:m.value=m.value.Trim();w=ISQ.Data.checkString(m.value,"phone")&&(m.value);break;case ISQ.WebForms.enumSelectTypes.custom.value:if(b[k].rx){w=c.regexVerification(m.value,b[k].rx)}else{w=true}break;default:if(m){w=m.value!=""}else{m=c.mGuiItems[k].getElementsByTagName("TEXTAREA")[0];if(m){w=m.value!=""}}break}f=m.value;v&=(c.handleValidationResult("textbox",m,b[k].mf,b[k].vt,w,c.mGuiItems[k]))}break;case ISQ.WebForms.enumInputTypes.Selectbox:var m=c.mGuiItems[k].getElementsByTagName("select")[0];
if(c.mGuiItems[k].style.display!="none"){v&=(c.handleValidationResult("select",m,b[k].mf,b[k].vt,(m.selectedIndex>0),c.mGuiItems[k]));f=(m.options[m.selectedIndex].value&&m.options[m.selectedIndex].value!="null")?m.options[m.selectedIndex].value:m.options[m.selectedIndex].text}break;case ISQ.WebForms.enumInputTypes.CheckboxList:if(c.mGuiItems[k].style.display!="none"){var l=c.mGuiItems[k].getElementsByTagName("input");var n=false;for(var y=0;y<l.length;y++){if(!n){n=(c.handleValidationResult("checkbox",l[y],b[k].mf,b[k].vt,(l[y].checked),c.mGuiItems[k]))}if(l[y].checked){if(f.length){f+=","}f+=l[y].value}}if(n){for(var y=0;y<l.length;y++){c.handleValidationResult("checkbox",l[y],b[k].mf,b[k].vt,true,c.mGuiItems[k])}}v&=n}break;case ISQ.WebForms.enumInputTypes.RadioList:if(c.mGuiItems[k].style.display!="none"){var l=c.mGuiItems[k].getElementsByTagName("input");var n=false;var o=false;for(var y=0;y<l.length&&!o;y++){n=n||(c.handleValidationResult("radio",l[y],b[k].mf,b[k].vt,(l[y].checked),c.mGuiItems[k]));if(l[y].checked){if(f.length){f+=","}f+=l[y].value;o=true}}if(n){for(var y=0;y<l.length;y++){c.handleValidationResult("radio",l[y],b[k].mf,b[k].vt,true,c.mGuiItems[k])}}v&=n}break;case ISQ.WebForms.enumInputTypes.fileUpload:for(var y=0;y<c.fileUploadObjects.length;y++){if(c.fileUploadObjects[y].elementId!=b[k].id){continue}if(c.fileUploadObjects[y].container.style.display==="none"){break}var h=c.fileUploadObjects[y].fileUploader.mFileUploader.files();var t=0;if(h){t=h.ready.length+h.pending.length}v&=(c.handleValidationResult("fileUpload",null,b[k].mf,b[k].vt,(t>0),c.mGuiItems[k]));break}break}if(b[k]["in"]){fieldName=b[k]["in"]}else{fieldName=b[k].lv}if(fieldName&&f){if(b[k].it==ISQ.WebForms.enumInputTypes.Textbox){j.push({name:fieldName,value:(f)?f:"",type:ISQ.WebForms.mTextboxType[b[k].ti].html.toLowerCase()})}else{j.push({name:fieldName,value:(f)?f:"",type:"generic"})}}}if(!v){ISQ.WebForms.PreviewContact.searchAnim.hide();this.style.display="block"}if(c.hiddenFields){for(var k=0;k<c.hiddenFields.length;k++){if(c.hiddenFields[k].name&&c.hiddenFields[k].value){j.push({name:c.hiddenFields[k].name,value:c.hiddenFields[k].value,type:"generic"})
}}}if(c.hSubmit){for(var k=0;k<c.fileUploadObjects.length;k++){var u=c.fileUploadObjects[k].fileUploader.mFileUploader.files();var e=c.fileUploadObjects[k].elementId;var p=false;for(var y=0;y<b.length;y++){if(b[y].id==e&&c.mGuiItems[y].style.display=="none"){p=true;break}}if(u&&!p){if(u.pending.length>0){c.showUploadInProcessMessage(v,this);v=false}else{for(var y=0;y<u.ready.length;y++){var g=u.ready[y].substring(u.ready[y].lastIndexOf("/")+1);j.push({name:y+" - "+g,value:u.ready[y],type:"attachment"})}}}}if(ISQ.WebForms.PreviewContact.predefinedValues.length>0){j=j.concat(ISQ.WebForms.PreviewContact.predefinedValues)}var s={values:j,postUrl:c.mPostUrl,redirectParam:c.mRedirectParam};c.hSubmit.handle(v,s)}}};ISQ.WebForms.PreviewContact.prototype.showUploadInProcessMessage=function(b,a){if(b){this.autoSubmitForm=function(){a.click()};this.revetAutoSubmit=function(){ISQ.WebForms.PreviewContact.searchAnim.hide();a.style.display="block"}}else{this.autoSubmitForm=null}};ISQ.WebForms.PreviewContact.prototype.activateInputs=function(e,g){var f=this;for(var d=0;d<e.length;d++){if(this.layoutCols!=2){var a=[];var b=[];for(var h=0;h<g.length;h++){var c=g[h];if(c.value==d){a.push(_("CF_guiID"+c.child));b.push(c.child)}}if(a.length===0){continue}e[d].controlled=a}e[d].controlledIds=b;e[d].controlled=a;e[d].inputIndex=d;e[d].onclick=function(){if(f.layoutCols==2){var l=false;for(var m=0;m<g.length;m++){var j=g[m];for(var k=0;k<f.formSerialize.length;k++){if((f.formSerialize[k].id==j.child)&&(this.inputIndex==j.value)){f.formSerialize[k].visible=(this.checked)?true:false;l=true;if(!this.checked){f.resetFieldValue(j.child)}}}}if(l){f.generateTable(f.formSerialize)}}else{if(this.controlled){for(var m=0;m<this.controlled.length;m++){this.controlled[m].style.display=(this.checked)?"block":"none";if(!this.checked){f.resetFieldValue(this.controlledIds[m])}}}}if(f.hCSSloader){f.hCSSloader.handle({stopFadeEffect:true})}};e[d].execute=e[d].onclick;this.dependencyExecuter.push(e[d])}};ISQ.WebForms.PreviewContact.prototype.activateRadios=function(g,j){var h=this;
for(var f=0;f<g.length;f++){var a=[];var b=[];var d=[];var c=[];if(this.layoutCols!=2){for(var k=0;k<j.length;k++){var e=j[k];if(e.value==f){a.push(_("CF_guiID"+e.child));d.push(e.child)}else{b.push(_("CF_guiID"+e.child));c.push(e.child)}}g[f].controlledBlockIds=c;g[f].blocked=b;g[f].controlled=a}g[f].inputIndex=f;g[f].onclick=function(){if(h.layoutCols==2){var n=false;for(var o=0;o<j.length;o++){var l=j[o];for(var m=0;m<h.formSerialize.length;m++){if(h.formSerialize[m].id==l.child){if((this.inputIndex==l.value&&this.checked)){h.formSerialize[m].visible=true}else{h.formSerialize[m].visible=false;h.resetFieldValue(l.child)}n=true}}}if(n){h.generateTable(h.formSerialize)}}else{for(var o=0;o<this.controlled.length;o++){this.controlled[o].style.display=(this.checked)?"block":"none"}for(var o=0;o<this.blocked.length;o++){this.blocked[o].style.display="none";h.resetFieldValue(this.controlledBlockIds[o])}}if(h.hCSSloader){h.hCSSloader.handle({stopFadeEffect:true})}};if(g[f].checked){g[f].execute=g[f].onclick;this.dependencyExecuter.push(g[f])}}};ISQ.WebForms.PreviewContact.prototype.activateSelect=function(c,b){if(!c){return}var a=this;c.onchange=function(){for(var g=0;g<b.length;g++){var e=b[g];if(a.layoutCols==2){for(var f=0;f<a.formSerialize.length;f++){if(a.formSerialize[f].id==e.child){if(this.selectedIndex==e.value){a.formSerialize[f].visible=true}else{a.formSerialize[f].visible=false;a.resetFieldValue(e.child)}break}}}else{var d=(_("CF_guiID"+e.child));d.style.display=(this.selectedIndex==(e.value))?"block":"none";if(this.selectedIndex==(e.value)){d.style.display="block"}else{d.style.display="none";a.resetFieldValue(e.child)}}}if(a.layoutCols==2){a.generateTable(a.formSerialize)}if(a.hCSSloader){a.hCSSloader.handle({stopFadeEffect:true})}};c.onkeyup=c.onchange;c.execute=c.onchange;this.dependencyExecuter.push(c)};ISQ.WebForms.PreviewContact.prototype.resetFieldValue=function(c){for(var d=0;d<this.formSerialize.length;d++){if(this.formSerialize[d].id==c){if(this.formSerialize[d].it==ISQ.WebForms.enumInputTypes.Selectbox){var a=(_("CF_guiID"+c)).getElementsByTagName("select")[0];
a.selectedIndex=0;a.onchange()}else{if(this.formSerialize[d].it==ISQ.WebForms.enumInputTypes.RadioList||this.formSerialize[d].it==ISQ.WebForms.enumInputTypes.CheckboxList){var b=(_("CF_guiID"+c)).getElementsByTagName("input");for(var e=0;e<b.length;e++){b[e].checked=false;if(b[e].onclick){b[e].onclick()}}}}break}}};ISQ.WebForms.PreviewContact.prototype.resetDependency=function(a){};ISQ.WebForms.PreviewContact.prototype.setStyle=function(a,c){var b=c;var d="";if(a.cc){b.className+=" "+a.cc}else{if(a.fc){d+="background-color:"+a.bc+";color:"+a.fc+";"}}if(a.fs){if(a.fs.indexOf("Underline")>-1){d+="text-decoration:underline;"}if(a.fs.indexOf("Bold")>-1){d+="font-weight:bold;"}if(a.fs.indexOf("Italic")>-1){d+="font-style:italic;"}if(a.fs.indexOf("pt")>-1){d+="font-size:"+parseInt(a.fs.substring(0,a.fs.indexOf("pt")))+"pt;"}}if(a.ta){d+="text-align:"+a.ta+" !important;"}ISQ.CSS.removeStyle("CFP_cssItem"+a.id);if(d!=""){d=".CF_elementClass"+a.id+"{"+d+"}";ISQ.CSS.addNewStyle(d,"CFP_cssItem"+a.id);b.className+=" CF_elementClass"+a.id}};ISQ.WebForms.PreviewContact.prototype.initButtonStyles=function(a,b){var c="";if(b.colorsClass){a.className+=" "+b.colorsClass}else{if(b.foreColor||b.backgroundColor){c+="background-color:"+b.backgroundColor+";";c+="color:"+b.foreColor+";"}}if(b.fontStyle){if(b.fontStyle.indexOf("Underline")>-1){c+="text-decoration:underline;"}if(b.fontStyle.indexOf("Bold")>-1){c+="font-weight:bold;"}if(b.fontStyle.indexOf("Italic")>-1){c+="font-style:italic;"}if(b.fontStyle.indexOf("pt")>-1){c+="font-size:"+parseInt(b.fontStyle.substring(0,b.fontStyle.indexOf("pt")))+"pt;"}}ISQ.CSS.removeStyle("CF_cssItem"+b.button+this.id);if(!c){return}if(b.button=="Submit"){c='.CF_buttonsFieldDiv>input[type="button"] {'+c+"}"}else{c='.CF_buttonsFieldDiv>input[type="reset"] {'+c+"}"}ISQ.CSS.addNewStyle(c,"CF_cssItem"+b.button+this.id)};ISQ.WebForms.PreviewContact.prototype.createLabel=function(b,e){var a="";if(b.cs){a+="&."+b.cs}var c=createDiv(this.previewContainer,".CF_TitleDivElementContainer&.borderBoxSizing"+a);var d=createDiv(c,".CF_TitleDivElement");
d.setAttribute("tabindex",this.getTabIdx());d.innerHTML=b.lv;return c};ISQ.WebForms.PreviewContact.prototype.createSubmitButtons=function(b,d){var c=createDiv(this.previewContainer,".CF_buttonsFieldDiv&.borderBoxSizing");var e=createInput("button","submitbutton",c,b.sv,null,".widgetTextColor&.widgetBGcolor",null);var a=createInput("reset","cancelbutton",c,b.cv,null,".widgetBGcolorText",null);e.setAttribute("tabindex",this.getTabIdx());a.setAttribute("tabindex",this.getTabIdx());this.initButtonStyles(e,{button:"Submit",backgroundColor:b.bc,foreColor:b.fc,fontStyle:b.fs,colorsClass:b.cc,colorIndex:b.ci,backgroundColorIndex:b.bci});this.initButtonStyles(a,{button:"Cancel",backgroundColor:b.bcC,foreColor:b.fcC,fontStyle:b.fsC,colorsClass:b.ccC,colorIndex:b.ciC,backgroundColorIndex:b.bciC});return c};ISQ.WebForms.PreviewContact.prototype.addtoSelect=function(b,a){var c=createElement("option");if(b.text){c.text=ISQ.Data.decodeEntities(b.text);c.value=b.value}else{c.text=ISQ.Data.decodeEntities(b);c.value=c.text}if(!ISQ.Http.browser.isIE7){a.add(c,null)}else{a.options[a.options.length]=new Option(c.text,c.value)}};ISQ.WebForms.PreviewContact.tabIndex=4;ISQ.WebForms.PreviewContact.prototype.createLabelForItem=function(f,a,b,d,c){if(c){var e=createElement("div",null,".CF_labelClass");e.setAttribute("tabindex",this.getTabIdx())}else{var e=createElement("label",null,".CF_labelClass&.fieldElement")}e.setAttribute("for",d);f.appendChild(e);if(a.it==ISQ.WebForms.enumInputTypes.fileUpload&&!this.layoutWithLabels){e.innerHTML=a.lv==null?"":a.lv;e.innerHTML+=(a.mf)?'<span style="color:red">*</span>':"";e.className+=" CF_fpIcon_Upload";var g=createDiv(e,".CF_labelIcons&.CF_floatingIcons&.CF_fpIcon_Upload")}else{if(this.layoutWithLabels||a.it==ISQ.WebForms.enumInputTypes.fileUpload||a.it==ISQ.WebForms.enumInputTypes.CheckboxList||a.it==ISQ.WebForms.enumInputTypes.RadioList||a.it==ISQ.WebForms.enumInputTypes.Selectbox){e.innerHTML=a.lv==null?"":a.lv;e.innerHTML+=(a.mf)?'<span style="color:red">*</span>':""}else{if(a.it==ISQ.WebForms.enumInputTypes.Textbox){if(!this.layoutWithLabels&&(ISQ.Http.browser.isIE7||ISQ.Http.browser.isIE8||ISQ.Http.browser.isIE9)){ISQ.Html.setPlaceHolder(b,(a.lv.length>30)?a.lv.substring(0,30)+"...":a.lv,"CF_placeHolderIE",f)
}e.className="CF_labelIcons CF_floatingIcons";switch(a.ti){case ISQ.WebForms.enumSelectTypes.email.value:e.className+=" CF_fpIcon_Email";break;case ISQ.WebForms.enumSelectTypes.phone.value:e.className+=" CF_fpIcon_Phone";break;case ISQ.WebForms.enumSelectTypes.subject.value:e.className+=" CF_fpIcon_Subject";break;case ISQ.WebForms.enumSelectTypes.message.value:e.className+=" CF_fpIcon_Message";break;case ISQ.WebForms.enumSelectTypes.comments.value:e.className+=" CF_fpIcon_Message";break;case ISQ.WebForms.enumSelectTypes.general.value:e.className+=" CF_fpIcon_Face";break;case ISQ.WebForms.enumSelectTypes.name.value:e.className+=" CF_fpIcon_Face";break}}else{e.className="CF_emptyIcons"}}}};ISQ.WebForms.PreviewContact.prototype.createContactSelectBox=function(b,e){var a="";if(b.cs){a+="&."+b.cs}var c=createDiv(this.previewContainer,".CF_textFieldDiv&.CF_DropDownDiv&.borderBoxSizing"+a);this.createLabelForItem(c,b,null,"selectbox"+e);var f=createElement("select");if(b.si){this.addtoSelect(b.si,f)}for(var d=0;d<b.so.length;d++){this.addtoSelect(b.so[d],f)}f.setAttribute("name","select"+e);f.setAttribute("id","selectbox"+e);f.setAttribute("tabindex",this.getTabIdx());c.appendChild(f);return c};ISQ.WebForms.PreviewContact.prototype.createListOption=function(c,g,a,h,b){var f=createDiv(g,".CF_listDivItem&.borderBoxSizing");if(h){var d=createInput("radio","RadioItem"+b,f,(c.value==null)?c.text:c.value,null,"",null,null)}else{var d=createInput("checkbox",null,f,(c.value==null)?c.text:c.value,null,null,null,null)}d.checked=(a)?true:false;d.setAttribute("tabindex",this.getTabIdx());var e=createElement("label",f);d.setAttribute("id","choiceInput"+this.mInputsIndentifier);e.setAttribute("for","choiceInput"+this.mInputsIndentifier);e.innerHTML=(c.text!=null)?c.text:"";this.mInputsIndentifier++};ISQ.WebForms.PreviewContact.prototype.createContactCheckbox=function(b,f){var a="";if(b.cs){a+="&."+b.cs}var c=createDiv(this.previewContainer,".CF_listDiv&.borderBoxSizing"+a);var g="checkbox"+f;this.createLabelForItem(c,b,null,g,f);var d=createDiv(c,".CF_ListItemsContainer");
for(var e=0;e<b.so.length;e++){this.createListOption(b.so[e],d,b.sc[e],false)}return c};ISQ.WebForms.PreviewContact.prototype.createContactRadio=function(b,f){var a="";if(b.cs){a+="&."+b.cs}var c=createDiv(this.previewContainer,".CF_listRadioDiv&.borderBoxSizing"+a);var g="radioInput"+f;this.createLabelForItem(c,b,null,g,f);var d=createDiv(c,".CF_ListItemsContainer");for(var e=0;e<b.so.length;e++){var h=null;if(b.sc&&b.sc.length>e){h=b.sc[e]}this.createListOption(b.so[e],d,h,true,f)}return c};ISQ.WebForms.PreviewContact.prototype.createContactTextBox=function(b,d){var a="";if(b.cs){a+="&."+b.cs}if(b.ml){a="&.textAreaContainer"}var c=createDiv(this.previewContainer,".CF_textFieldDiv&.borderBoxSizing"+a);if(b.ml){var e=createElement("textarea");e.setAttribute("id","textfield"+d)}else{var e=ISQ.Html.createInput("text","textfield"+d,null,null,null,"CFP_"+ISQ.WebForms.mTextboxType[b.ti].html,null)}this.createLabelForItem(c,b,e,"textfield"+d);if(b.tb){e.setAttribute("placeholder",b.tb)}e.setAttribute("maxLength",ISQ.WebForms.mTextboxType[b.ti].maxLength);e.setAttribute("tabindex",this.getTabIdx());c.appendChild(e);return c};ISQ.WebForms.PreviewContact.prototype.createContactFileUpload=function(c,g){var a=this.allowedFileExtensions.split(",");var b="";if(c.cs){b+="&."+c.cs}var d=createDiv(this.previewContainer,".CF_textFieldDiv&.CF_fileUpload&.borderBoxSizing"+b);var f=ISQ.Html.createInput("button","textfield"+g,null,null,null,".CFP_Upload",null);this.createLabelForItem(d,c,f,"fileupload"+g);f.setAttribute("tabindex",this.getTabIdx());var e=createDiv(d,".CF_fileUploadComp&.borderBoxSizing");e.appendChild(f);d.appendChild(e);f.value=ISQ.Widget.Texts[this.languageCode]?ISQ.Widget.Texts[this.languageCode]["chooseFile"]:ISQ.Widget.Localize.array.chooseFile;var j=this;var k=function(p){var o=false;if(p.indexOf(".")<0){o=false;var n="(none)"}else{var n=p.substring(p.lastIndexOf(".")+1).toLowerCase();c.allf=c.allf.toLowerCase();var l=c.allf.split(",");for(var q=0;q<l.length;q++){if(l[q]==n){o=true;break}}if(o){if(a.length!=1||(a.length==1&&a[0]!="")){for(var q=0;
q<a.length;q++){if(a[q]==n){o=true;break}}}}}var m=ISQ.Widget.Texts[this.languageCode]?ISQ.Widget.Texts[this.languageCode]["fileExtensionBlocked"]:ISQ.Widget.Localize.array.fileExtensionBlocked;m=m.replace("%var%",n);j.handleValidationResult("fileupload",null,true,m,(o),d);if(j.hCSSloader){j.hCSSloader.handle({stopFadeEffect:true})}return o};var h=new ISQ.WebForms.AttachmentsPlugin({attachments:0,itemId:"",container:j,maxFileUpload:c.msize,uploadValidation:k});h.parentContainer=e;h.owner=this;h.draw();h.mContentDiv=e;f.attachmentPlugin=h;f.onclick=function(){if(!j.hSubmit){return}var m=0;var l=this.attachmentPlugin.mFileUploader.files();if(l){m=l.ready.length+l.pending.length}j.handleValidationResult("fileupload",null,true,ISQ.Widget.Texts[this.languageCode]?ISQ.Widget.Texts[this.languageCode]["fileMaxReached"]:ISQ.Widget.Localize.array.fileMaxReached,(m<c.mmax),d);if(j.hCSSloader){j.hCSSloader.handle({stopFadeEffect:true})}if(m>=c.mmax){return}this.attachmentPlugin.openDialog()};this.fileUploadObjects.push({elementId:c.id,fileUploader:h,container:d});return d};ISQ.WebForms.AttachmentsPlugin=ISQ.Base.extend({name:"ISQ.WebForms.AttachmentsPlugin"});ISQ.WebForms.AttachmentsPlugin.prototype.ctor=function(a){this.mItemId=a.itemId;this.mAttachments=a.attachments;this.hUploadingFile=a.hUploadingFile||null;this.hRemovedFile=a.hRemovedFile||null;this.hFilesReady=a.hFilesReady||null;this.hFailed=a.hFailed||null;this.mOriginal=a.isOriginal||false;this.mContainer=a.container||null;this.mMaxFileSize=a.maxFileUpload||null;this.uploadValidation=a.uploadValidation||null};ISQ.WebForms.AttachmentsPlugin.prototype.dtor=function(){this.mAttachments=null;if(this.mContentDiv){clearNode(this.mContentDiv)}};ISQ.WebForms.AttachmentsPlugin.prototype.setContentDiv=function(a){if(this.mContentDiv){ISQ.Html.moveChildNodesToElement(this.mContentDiv,a)}this.mContentDiv=a};ISQ.WebForms.AttachmentsPlugin.prototype.hasFiles=function(){return this.mFileUploader.files()!==null};ISQ.WebForms.AttachmentsPlugin.prototype.readyFiles=function(b){if(!this.mFileUploader){return null
}var a=this.mFileUploader.files(true);if(!a){return null}if(b){return a.readyByBucket}else{return a.readyFullUrl}};ISQ.WebForms.AttachmentsPlugin.prototype.clear=function(b){if(!this.mFileUploader){return null}var a=this.mFileUploader.files(true);if(a){b.handle(a)}b.dispose();return a?a.readyFullUrl:null};ISQ.WebForms.AttachmentsPlugin.prototype.draw=function(c){var b=this;var a=this.mContainer;if(!this.mContentDiv){this.mContentDiv=createDiv()}else{clearNode(this.mContentDiv)}this.mFileUploader=new ISQ.FileUploader.Wrapper({uploadMetaData:_session().id()+","+b.mMaxFileSize,uploadingFileHandler:new ISQ.Handler(function(d){this.drawFileUploader(d);if(this.hUploadingFile){this.hUploadingFile.handle(d)}if(a.hCSSloader){a.hCSSloader.handle({stopFadeEffect:true})}},this),removedFileHandler:new ISQ.Handler(function(d){if(this.hRemovedFile){this.hRemovedFile.handle(d)}if(d.parentNode!=null&&d.parentNode.parentNode!=null){d.parentNode.parentNode.removeChild(d.parentNode)}this.owner.handleValidationResult("fileupload",null,false,"",true,b.parentContainer);if(a.hCSSloader){a.hCSSloader.handle({stopFadeEffect:true})}if(d.mBucket&&d.mKey){_session().sendData("<deleteS3TempFile>"+d.mBucket+","+d.mKey.substring(0,d.mKey.lastIndexOf("/")+1)+"</deleteS3TempFile>",new Ajax.Token({callback:new ISQ.Handler(function(){},this)}))}},this),filesReadyHandler:new ISQ.Handler(function(){if(this.hFilesReady){this.hFilesReady.handle()}if(a.hCSSloader){a.hCSSloader.handle({stopFadeEffect:true})}},this),uploadCompleteHandler:new ISQ.Handler(function(d){this.uploadComplete(d);if(a.hCSSloader&&!b.owner.autoSubmitForm){a.hCSSloader.handle({stopFadeEffect:true})}if(b.owner.autoSubmitForm){b.owner.autoSubmitForm()}},this),uploadFailedHandler:new ISQ.Handler(function(d){this.uploadFailed(d);if(this.hFailed){this.hFailed.handle(d)}if(a.hCSSloader){a.hCSSloader.handle({stopFadeEffect:true})}},this),filenameValidation:b.uploadValidation,keys:this.mAttachments,aclPublic:false});this.saved();this.mOriginalAttachments=this.mAttachments;var b=this};ISQ.WebForms.AttachmentsPlugin.prototype.reset=function(){this.mAttachments=null;
this.mFileUploader.dispose();this.draw()};ISQ.WebForms.AttachmentsPlugin.prototype.saved=function(){var a=this.mFileUploader.files();if(a){this.mAttachments=a.readyFullUrl}if(!a||this.mAttachments.length===0){this.mAttachments=null}this.mFileUploader.saved()};ISQ.WebForms.AttachmentsPlugin.prototype.checkForModifications=function(){if(!this.mFileUploader){return true}var a=this.mFileUploader.files();if(!a&&!this.mAttachments){return true}if(a){return ISQ.Tools.compareArrays(this.mAttachments,a.readyFullUrl)}return false};ISQ.WebForms.AttachmentsPlugin.prototype.openDialog=function(){this.mFileUploader.openDialog()};ISQ.WebForms.AttachmentsPlugin.prototype.clearAttachments=function(){this.mFileUploader.removeActiveAttachments();var a=ISQ.Widget.Texts[this.languageCode]?ISQ.Widget.Texts[this.languageCode]["filesDeleted"]:ISQ.Widget.Localize.array.filesDeleted;this.owner.handleValidationResult("fileupload",null,true,a,false,this.parentContainer);if(this.owner.hCSSloader){this.owner.hCSSloader.handle({stopFadeEffect:true})}};ISQ.WebForms.AttachmentsPlugin.prototype.drawFileUploader=function(k){if(!this.mContentDiv){this.mContentDiv=createDiv(null)}var c=createDiv(this.mContentDiv,".attachmentRow");var d=createDiv(c,".attachment");var b=createDiv(d,".attachmentIcon");d.id=this.getFileNameHash(k);this.mContentDiv.appendChild(this.mContentDiv.childNodes[this.mContentDiv.childNodes.length-2]);var j=createElement("span",d);j.innerHTML="Attaching "+k.mFilename;var g=createLink({parent:d,text:"",title:"Remove Attachment",style:".deleteFileLink",onclick:function(){d.uploader.remove()}});k.mUIcontainer=d.parentNode;var e=k.mFilename.length;var f;var h="..."+k.mFilename.substring(k.mFilename.length-4);while(this.mContentDiv.offsetWidth<parseInt(j.offsetWidth)+60&&e>0){e--;f="Attaching "+k.mFilename.substring(0,e)+h;j.innerHTML=f}if(e==0||e==k.mFilename.length){f="Attaching "+k.mFilename}var a=new ISQ.WebForms.AttachmentAnimation({container:j,filename:f});k.parentNode=c;d.attachAnim=a;d.textSpan=j;d.uploader=k;return d};ISQ.WebForms.AttachmentsPlugin.prototype.uploadComplete=function(e){var a=_(this.getFileNameHash(e));
if(!a){a=this.drawFileUploader(e)}a.attachAnim.dispose();a.textSpan.innerHTML="";var c=e.mFilename;var b=createLink({parent:a.textSpan,href:e.redirectionUrl(),target:"_blank",text:c,style:".fileUploadLink"});var d=c.length;while(this.mContentDiv.offsetWidth<a.textSpan.offsetWidth+50&&d>0){d--;fileTextNew=c.substring(0,d)+"..."+c.substring(c.length-4);b.innerHTML=fileTextNew}if(d==0){b.innerHTML=c}};ISQ.WebForms.AttachmentsPlugin.prototype.uploadFailed=function(b){var a="";if(b.failReason){if(b.failReason=="S3Block"){a=ISQ.Widget.Texts[this.languageCode]?ISQ.Widget.Texts[this.languageCode]["fileBlockedFileSize"]:ISQ.Widget.Localize.array.fileBlockedFileSize;a=a.replace("%var%",this.mMaxFileSize);b.remove()}else{if(b.failReason=="nanoRepBlock"){var a=ISQ.Widget.Texts[this.languageCode]?ISQ.Widget.Texts[this.languageCode]["fileBlocked"]:ISQ.Widget.Localize.array.fileBlocked}}}this.owner.handleValidationResult("fileupload",null,true,a,false,this.parentContainer);if(this.owner.hCSSloader){this.owner.hCSSloader.handle({stopFadeEffect:true})}if(this.owner.autoSubmitForm){this.owner.revetAutoSubmit()}};ISQ.WebForms.AttachmentsPlugin.prototype.getFileNameHash=function(a){return ISQ.Tools.Base64.encodeString((a.mKey||a.mFilename)+this.mItemId)};ISQ.WebForms.AttachmentsPlugin.prototype.mAttachments=null;ISQ.WebForms.AttachmentsPlugin.prototype.mOriginalAttachments=null;ISQ.WebForms.AttachmentsPlugin.prototype.mItemId=null;ISQ.WebForms.AttachmentsPlugin.prototype.mFileUploader=null;ISQ.WebForms.AttachmentsPlugin.prototype.mReadOnly=null;ISQ.WebForms.AttachmentsPlugin.prototype.mEditor=null;ISQ.WebForms.AttachmentsPlugin.prototype.mContentDiv=null;ISQ.WebForms.AttachmentsPlugin.prototype.mOriginal=false;ISQ.WebForms.AttachmentsPlugin.prototype.hUploadingFile=null;ISQ.WebForms.AttachmentsPlugin.prototype.hRemovedFile=null;ISQ.WebForms.AttachmentsPlugin.prototype.hFilesReady=null;ISQ.WebForms.AttachmentsPlugin.prototype.hFailed=null;ISQ.WebForms.AttachmentAnimation=ISQ.Base.extend({name:"ISQ.WebForms.AttachmentsPlugin"});ISQ.WebForms.AttachmentAnimation.prototype.ctor=function(a){this.container=a.container;
this.filename=a.filename;this.start()};ISQ.WebForms.AttachmentAnimation.prototype.start=function(){var a=this;this.idx=1;this.timer=setInterval(function(){a.repeater(a)},250)};ISQ.WebForms.AttachmentAnimation.prototype.repeater=function(b){var c="";for(var a=0;a<b.idx;a++){c+="."}b.container.innerHTML=b.filename+c;b.idx++;if(b.idx==4){b.idx=0}};ISQ.WebForms.AttachmentAnimation.prototype.dtor=function(){clearInterval(this.timer);this.timer=null};ISQ.Console=initializeNS("ISQ.Console");ISQ.FileUploader=ISQ.Base.extend({name:"ISQ.Console.FileLoader"});ISQ.FileUploader.uploadersCounter=0;ISQ.FileUploader.wrappersArr=null;ISQ.FileUploader.registeredPageGC=false;ISQ.FileUploader.successResponse=function(c){var c=c.split(".");var d=ISQ.FileUploader.wrappersArr[c[0]];if(d){d.successResponse(c[1])}};ISQ.FileUploader.getRedirectUrlByFileName=function(e,d){var f=e.indexOf("/");if(f==-1){return""}return ISQ.FileUploader.getRedirectUrl(e.substring(0,f),e.substring(f+1),d)};ISQ.FileUploader.getRedirectUrl=function(e,f,d){if(d){return"http://"+e+".s3.amazonaws.com/"+f}return"/common/fileuploader/attachmentRedirection.html?b="+e+"&f="+ISQ.Data.getURLencodedString(f)+"&sid="+_session().id()};ISQ.FileUploader.clearArray=function(){if(!ISQ.FileUploader.wrappersArr){return}for(var b in ISQ.FileUploader.wrappersArr){ISQ.FileUploader.wrappersArr[b].dispose()}ISQ.FileUploader.wrappersArr=null};ISQ.FileUploader.Wrapper=ISQ.Base.extend({name:"ISQ.Console.FileLoader.Wrapper"});ISQ.FileUploader.Wrapper.prototype.ctor=function(b){if(!ISQ.FileUploader.wrappersArr){ISQ.FileUploader.wrappersArr=new Array();if(typeof("sessionGC")==="function"){ISQ.Tools.addArrayToGC(sessionGC(),ISQ.FileUploader.wrappersArr)}}this.mId=ISQ.FileUploader.wrappersArr.length;ISQ.FileUploader.wrappersArr[this.mId]=this;if(!ISQ.FileUploader.registeredPageGC){ISQ.FileUploader.registeredPageGC=true;if(typeof("pageGC")==="function"){pageGC().add({dispose:function(){ISQ.FileUploader.clearArray();ISQ.FileUploader.registeredPageGC=false}})}}this.mFilesReadyEvent=null;this.mArray=new Array();
this.mPredefinedKeys=b.keys||null;this.mAclPublic=b.aclPublic||false;this.mAclPublicFunc=b.aclPublicFunc||null;this.mFilesReadyHandler=b.filesReadyHandler||null;this.append(b)};ISQ.FileUploader.Wrapper.prototype.dtor=function(){for(var b in this.mArray){this.mArray[b].dispose();this.mArray[b]=null;delete this.mArray[b]}ISQ.FileUploader.wrappersArr[this.mId]=null;delete ISQ.FileUploader.wrappersArr[this.mId]};ISQ.FileUploader.Wrapper.prototype.append=function(f){var d=null;if(this.mPredefinedKeys!=null&&this.mPredefinedKeysNdx<this.mPredefinedKeys.length){d=this.mPredefinedKeys[this.mPredefinedKeysNdx++]}var e=++ISQ.FileUploader.uploadersCounter;this.mArray[e]=new ISQ.FileUploader({wrapperId:this.mId,id:e,multiple:f.multiple!==false,uploadMetaData:f.uploadMetaData,uploadingFileHandler:f.uploadingFileHandler,filenameValidation:f.filenameValidation,removedFileHandler:f.removedFileHandler,uploadCompleteHandler:f.uploadCompleteHandler,uploadFailedHandler:f.uploadFailedHandler,key:d,aclPublic:(d&&typeof(this.mAclPublicFunc)=="function"?this.mAclPublicFunc(d):this.mAclPublic)})};ISQ.FileUploader.Wrapper.prototype.openDialog=function(){this.mArray[this.mArray.length-1].openDialog()};ISQ.FileUploader.Wrapper.prototype.fileSelected=function(){++this.mTotalUploaders};ISQ.FileUploader.Wrapper.prototype.removePendingAttachments=function(){for(var b in this.mArray){if(!this.mArray[b].mInUploadProcess){continue}this.mArray[b].dispose();this.mArray[b]=null;delete this.mArray[b]}};ISQ.FileUploader.Wrapper.prototype.removeActiveAttachments=function(){for(var b in this.mArray){if(this.mArray[b].mKey){this.mArray[b].remove(true);this.mArray[b]=null;delete this.mArray[b]}}this.mTotalUploaders=0;this.mUploadersReady=0};ISQ.FileUploader.Wrapper.prototype.uploaderDisposed=function(b){if(!this.mArray[b].mPreloadedFile){--this.mTotalUploaders;if(this.mArray[b].mCountedAsReady){--this.mUploadersReady}}this.mArray[b]=null;delete this.mArray[b];this.fireEvent()};ISQ.FileUploader.Wrapper.prototype.failedResponse=function(b){this.uploaderFinished(b,false)
};ISQ.FileUploader.Wrapper.prototype.successResponse=function(b){this.uploaderFinished(b,true)};ISQ.FileUploader.Wrapper.prototype.uploaderFinished=function(d,f){var e=this.mArray[d];if(!e){return}e.mCountedAsReady=true;++this.mUploadersReady;if(f){e.fileUploaded()}this.fireEvent()};ISQ.FileUploader.Wrapper.prototype.fireEvent=function(){if(this.mFilesReadyEvent&&this.mUploadersReady===this.mTotalUploaders){this.mFilesReadyEvent.dispatch(this.files())}if(this.mFilesReadyHandler){this.mFilesReadyHandler.handle(this.files())}};ISQ.FileUploader.Wrapper.prototype.files=function(d){var f=null;for(var e in this.mArray){if(this.mArray[e].isDisposed()){continue}if(this.mArray[e].mToUploadFile){if(!f){f={};f.pending=new Array();f.ready=new Array();f.discard=new Array();f.readyFullUrl=new Array();if(d){f.readyByBucket=new Array()}}f.ready.push(this.mArray[e].mKey);f.readyFullUrl.push(this.mArray[e].mBucket+"/"+this.mArray[e].mKey);if(d){if(!f.readyByBucket[this.mArray[e].mBucket]){f.readyByBucket[this.mArray[e].mBucket]=new Array()}f.readyByBucket[this.mArray[e].mBucket].push(this.mArray[e].mKey)}}else{if(this.mArray[e].mInUploadProcess){if(!f){f={};f.pending=new Array();f.ready=new Array();f.discard=new Array();f.readyFullUrl=new Array();if(d){f.readyByBucket=new Array()}}f.pending.push(this.mArray[e].mKey)}else{if(!this.mArray[e].mBucket||!this.mArray[e].mKey){continue}if(!this.mArray[e].mPreloadedFile){continue}if(!f){f={};f.pending=new Array();f.ready=new Array();f.discard=new Array();f.readyFullUrl=new Array();if(d){f.readyByBucket=new Array()}}if(!f.discard[this.mArray[e].mBucket]){f.discard[this.mArray[e].mBucket]=new Array()}f.discard[this.mArray[e].mBucket].push(this.mArray[e].mKey)}}}return f};ISQ.FileUploader.Wrapper.prototype.filesReadyEvent=function(){if(!this.mFilesReadyEvent){this.mFilesReadyEvent=new ISQ.Event()}return this.mFilesReadyEvent};ISQ.FileUploader.Wrapper.prototype.saved=function(c){for(var d in this.mArray){this.mArray[d].saved(c)}};ISQ.FileUploader.Wrapper.prototype.mArray=null;ISQ.FileUploader.Wrapper.prototype.mId;
ISQ.FileUploader.Wrapper.prototype.mUploadersReady=0;ISQ.FileUploader.Wrapper.prototype.mTotalUploaders=0;ISQ.FileUploader.Wrapper.prototype.mFilesReadyEvent=null;ISQ.FileUploader.Wrapper.prototype.mPredefinedKeys=null;ISQ.FileUploader.Wrapper.prototype.mPredefinedKeysNdx=0;ISQ.FileUploader.Wrapper.prototype.mAclPublic=false;ISQ.FileUploader.Wrapper.prototype.mAclPublicFunc=null;ISQ.FileUploader.Wrapper.prototype.mFilesReadyHandler=null;ISQ.FileUploader.prototype.ctor=function(c){this.mWrapperId=c.wrapperId;this.mId=c.id;this.mUploadMetaData=c.uploadMetaData;this.mUploadingFileHandler=c.uploadingFileHandler||null;this.mFilenameValidation=c.filenameValidation||null;this.mRemovedFileHandler=c.removedFileHandler||null;this.mUploadCompleteHandler=c.uploadCompleteHandler||null;this.mUploadFailedHandler=c.uploadFailedHandler||null;this.mAclPublic=c.aclPublic||false;if(c.key){var d=c.key.indexOf("/");if(d==-1){throw ("FileUploader.ctor: invalid url")}this.mBucket=c.key.substring(0,d);this.mKey=c.key.substring(d+1);this.mFilename=c.key.substring(c.key.LastIndexOf("/")+1);this.mPreloadedFile=true;this.fileUploaded();this.append()}else{this.mIframeReadyHandler=new ISQ.Handler(this.buildForm,this);this.mIframe=ISQ.Html.createInvisibleIframe(this.mIframeReadyHandler)}};ISQ.FileUploader.prototype.dtor=function(b){if(this.mIframe){this.mIframe.parentNode.removeChild(this.mIframe)}if(b){this.mUploadingFileHandler=null;this.mFilenameValidation=null;this.mRemovedFileHandler=null;this.mUploadCompleteHandler=null;this.mUploadFailedHandler=null;ISQ.FileUploader.wrappersArr[this.mWrapperId].uploaderDisposed(this.mId)}};ISQ.FileUploader.prototype.buildForm=function(f){ISQ.Html._doc=f;var e=createElement("form",f.body);e.action="https://{bucket}.s3.amazonaws.com/";e.method="post";e.enctype="multipart/form-data";e.setAttribute("enctype","multipart/form-data");e.encoding="multipart/form-data";e.setAttribute("encoding","multipart/form-data");this.mForm=e;createInput("hidden","key",e,"");createInput("hidden","AWSAccessKeyId",e,"");createInput("hidden","acl",e,(this.mAclPublic?"public-read":"private"));
createInput("hidden","success_action_redirect",e,("https:"==document.location.protocol?"https://":"http://")+ISQ.Http.domain(true)+"/common/fileuploader/fileUploaderSuccess.html?up="+this.mWrapperId+"."+this.mId);createInput("hidden","policy",e,"");createInput("hidden","signature",e,"");createInput("hidden","Content-Type",e,"");this.mFileInput=createInput("file","file",e,null,null,"opacity:0;cursor:pointer;position:absolute;top:0;");ISQ.Html._doc=document;this.mFileInput.onchange=this.fileSelected;this.mFileInput.uploader=this;var g=this;var h=function(){setTimeout(function(){g.iframeLoaded()},0)};if(ISQ.Http.browser.app==="opera"){this.mIframe.onload=h}else{if(document.addEventListener){this.mIframe.addEventListener("load",h,true)}else{if(document.attachEvent){this.mIframe.attachEvent("onload",h)}}}};ISQ.FileUploader.prototype.iframeLoaded=function(){this.mInUploadProcess=false;if(this.mSuccess){return}if(!this.mKey){return}this.failReason="S3Block";if(this.mUploadFailedHandler){this.mUploadFailedHandler.handle(this)}if(ISQ.FileUploader.wrappersArr&&ISQ.FileUploader.wrappersArr[this.mWrapperId]){ISQ.FileUploader.wrappersArr[this.mWrapperId].failedResponse(this.mId)}};ISQ.FileUploader.prototype.openDialog=function(){this.mFileInput.click()};ISQ.FileUploader.prototype.fileSelected=function(){if(this.uploader){arguments.callee.apply(this.uploader,[this.value]);return}if(ISQ.Http.browser.isFF3){this.mIframe.style.top="-500px";this.mIframe.style.left="0px";this.mIframe.style.visibility="hidden"}this.mFilename=arguments[0];if(!this.mFilename){return}var d=false;if(this.mFilenameValidation){if(!this.mFilenameValidation(this.mFilename)){return}d=true}var f=this.mFilename.LastIndexOf(".");if(f!==-1&&f!==this.mFilename.length-1){var e=this.mFilename.substring(f+1).toLowerCase();if(!d&&!_session().configuration("allowedExtensions").toLowerCase().contains(e)){messageBox().show({title:"Error",text:"This file type is not supported."});return}}this.mFilename=this.mFilename.replace(/\{|\}|,|\!|\@|\#|\$|\^|\&|\(|\)|\%|\||\*|\~|\=|\+/g,"_");
if(this.mFilename.indexOf(".")>-1){var e=this.mFilename.substr(this.mFilename.lastIndexOf(".")+1);this.mContentType=ISQ.Tools.getContentTypeByExtension(e,true)||"application/octet-stream"}ISQ.FileUploader.wrappersArr[this.mWrapperId].fileSelected(this);this.mInUploadProcess=true;if(this.mFilename.contains("\\")){this.mFilename=this.mFilename.substring(this.mFilename.LastIndexOf("\\")+1)}this.append();_session().sendData("<getUploadParams>"+this.mUploadMetaData+"</getUploadParams>",new Ajax.Token({callback:new ISQ.Handler(this.readyToUpload,this)}))};ISQ.FileUploader.prototype.append=function(){ISQ.FileUploader.wrappersArr[this.mWrapperId].append({uploadMetaData:this.mUploadMetaData,uploadingFileHandler:this.mUploadingFileHandler,filenameValidation:this.mFilenameValidation,removedFileHandler:this.mRemovedFileHandler,uploadCompleteHandler:this.mUploadCompleteHandler,uploadFailedHandler:this.mUploadFailedHandler})};ISQ.FileUploader.prototype.readyToUpload=function(response){var S3data=null;try{var node=ISQ.Data.Xml.getFirstElementByName(response.xml,"nR");S3data=eval("("+node.firstChild.nodeValue+")")}catch(e){S3data=null}if(!S3data){this.mInUploadProcess=false;this.failReason="nanoRepBlock";if(this.mUploadFailedHandler){this.mUploadFailedHandler.handle(this)}return}this.mForm.action=unescape(this.mForm.action).replace("{bucket}",S3data.bucket);this.mBucket=S3data.bucket;this.mForm.key.value=this.mKey=S3data.key+this.mFilename;this.mForm["Content-Type"].value=this.mContentType;this.mForm.AWSAccessKeyId.value=S3data.id;this.mForm.policy.value=S3data.policy;this.mForm.signature.value=S3data.signature;this.mForm.submit();if(this.mUploadingFileHandler){this.mUploadingFileHandler.handle(this)}};ISQ.FileUploader.prototype.fileUploaded=function(){this.mToUploadFile=true;this.mSuccess=true;if(this.mUploadCompleteHandler){this.mUploadCompleteHandler.handle(this)}};ISQ.FileUploader.prototype.redirectionUrl=function(){return ISQ.FileUploader.getRedirectUrl(this.mBucket,this.mKey,this.mAclPublic)};ISQ.FileUploader.prototype.saved=function(b){if(this.mFilename&&this.mSuccess){if(this.mToUploadFile){this.mPreloadedFile=true
}else{if(!b){this.dispose(true)}}}};ISQ.FileUploader.prototype.remove=function(b){this.mToUploadFile=false;this.mInUploadProcess=false;if(this.mRemovedFileHandler){this.mRemovedFileHandler.handle(this,true)}if(b||(this.mIframe&&!this.mPreloadedFile)){this.dispose(true)}};ISQ.FileUploader.prototype.mIframe=null;ISQ.FileUploader.prototype.mForm=null;ISQ.FileUploader.prototype.mFileInput=null;ISQ.FileUploader.prototype.mFilename=null;ISQ.FileUploader.prototype.mToUploadFile=false;ISQ.FileUploader.prototype.mBucket=null;ISQ.FileUploader.prototype.mKey=null;ISQ.FileUploader.prototype.mContentType=null;ISQ.FileUploader.prototype.mId;ISQ.FileUploader.prototype.mSuccess=false;ISQ.FileUploader.prototype.mInUploadProcess=false;ISQ.FileUploader.prototype.mUploadMetaData=null;ISQ.FileUploader.prototype.mUploadingFileHandler=null;ISQ.FileUploader.prototype.mFilenameValidation=null;ISQ.FileUploader.prototype.mWrapperId=null;ISQ.FileUploader.prototype.mIframeReadyHandler=null;ISQ.FileUploader.prototype.mRemovedFileHandler=null;ISQ.FileUploader.prototype.mUploadCompleteHandler=null;ISQ.FileUploader.prototype.mAclPublic=false;ISQ.FileUploader.prototype.mPreloadedFile=false;ISQ.FileUploader.prototype.mUploadFailedHandler=null;
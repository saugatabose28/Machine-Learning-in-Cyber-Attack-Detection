ISQ.CDC=initializeNS("ISQ.CDC");if(typeof(nanoRep)==="undefined"){window.nanoRep={}}if(typeof(nanoRep.CDC)==="undefined"){nanoRep.CDC={}}nanoRep.CDC.Helper={splitURLArguments:function(n){var p=new Array();var r=n;var l=r.length;if(l===0){return p}var k=function(a){return unescape(a.join("").toString()).replace(/^\s+|\s+$/g,"")};var q=1;var m="";var o=0;var j=new Array();while(o<l){switch(q){case 1:if(r.charAt(o)!=="="){j.push(r.charAt(o))}else{q=2;m=k(j).toLowerCase();j=new Array()}break;case 2:if(r.charAt(o)!=="&"){j.push(r.charAt(o))}else{q=1;p[m]=k(j);j=new Array()}break}++o}if(q===2){p[m]=k(j)}return p},getTargetWindow:function(e,i){if(!e){return window.top}var l=window;if(i){l=window.parent}if(e==="parent"){return l.parent}var k=false;var j;do{try{if(l===window.top){k=true}j=l.frames[e];if(j){return j}}catch(h){}l=l.parent}while(!k);return window.top},parseMessage:function(c){if(!c){return""}var d=nanoRep.CDC.Helper.splitURLArguments(c);d.s=unescape(d.s);d.t=unescape(d.t);return d}};ISQ.CDC.User=ISQ.Base.extend({name:"ISQ.CDC.User"});ISQ.CDC.User.prototype.ctor=function(b){this.mTargetWindowName=b.targetWindowName||"";this.mProxyIFrameUrl=b.proxyIFrameUrl||null;this.mAllowMessagesFrom=b.allowMessagesFrom||null;this.incomingMessageEvent=new ISQ.Event();this.mWidget=b.widget||null;this.eFilterMessages=new ISQ.Event();if(typeof(ISQ.CDC.users)==="undefined"){ISQ.CDC.users=new Array()}ISQ.CDC.users.push(this);if(typeof(window.postMessage)!="function"&&typeof(window.postMessage)!="object"){this.mLegacyMode=true;this.mHost_l=window.location.protocol+"//"+window.location.host;if(this.mProxyIFrameUrl){if(this.mProxyIFrameUrl.contains("?")){this.mProxyIFrameUrl+="&srv="+b.server}else{this.mProxyIFrameUrl+="?srv="+b.server}}}else{var a=this;this.mPostMessageEventListener=function(d){if(d.origin!==a.mAllowMessagesFrom){return}var c=ISQ.CDC.Helper.splitURLArguments(d.data);c.s=unescape(d.origin);c.t="*";a.dispatchMessage(c)};if(window.addEventListener){window.addEventListener("message",this.mPostMessageEventListener,false)
}else{if(window.attachEvent){window.attachEvent("onmessage",this.mPostMessageEventListener)}}}};ISQ.CDC.User.prototype.dtor=function(){if(this.mProxyIFrame_l&&this.mProxyIFrame_l.parentNode!==null){document.body.removeChild(this.mProxyIFrame_l)}if(!this.mLegacyMode){if(window.removeEventListener){window.removeEventListener("message",this.mPostMessageEventListener,false)}else{if(window.detachEvent){window.detachEvent("onmessage",this.mPostMessageEventListener)}}}};ISQ.CDC.User.prototype.sendMessage=function(b,e){e=e||"*";if(!this.mLegacyMode){var f=ISQ.CDC.Helper.getTargetWindow(this.mTargetWindowName);b+="&ord="+(++this.mMessageOrdinal);f.postMessage(b,e)}else{if(!this.mMessagesOnSent){this.mMessagesOnSent=new Array()}if(!this.mProxyIFrameBaseUrl_l){var a=new Array();a.push(this.mProxyIFrameUrl);a.push("#");a.push("s=");a.push(escape(this.mHost_l));a.push("&t=");a.push(escape(e));a.push("&twnd=");a.push(this.mTargetWindowName);this.mProxyIFrameBaseUrl_l=a.join("")}var c=function(g,l,h,n){var o=new Array();o.push(g.mProxyIFrameBaseUrl_l);o.push("&");o.push(h);o.push("&ord=");o.push(l);var m="position: absolute; left: 0px; top:-1100px;height:70px;width:70px;";var i=document.createElement("iframe");var j=ISQ.CDC.User.getIframeId();i.setAttribute("id",j);i.setAttribute("name",j);i.setAttribute("src",o.join(""));i.setAttribute("frameBorder","1");i.setAttribute("scrolling","auto");i.setAttribute("width","70px");i.setAttribute("height","70px");i.setAttribute("style",m);if(i.style.setAttribute){i.style.setAttribute("cssText",m)}document.body.appendChild(i);var k=function(){setTimeout(function(){g.mMessagesOnSent[l]=null},100)};if(ISQ.Http.browser.app==="opera"){i.onload=k}else{if(document.addEventListener){i.addEventListener("load",k,true)}else{if(document.attachEvent){i.attachEvent("onload",k)}}}};var d=++this.mMessageOrdinal;this.mMessagesOnSent[d]=new c(this,d,b,e)}};ISQ.CDC.User.prototype.dispatchMessage=function(d){if(d.widget&&this.mWidget!==d.widget){return}var h={message:d,filter:false};this.eFilterMessages.dispatch(h);
if(h.filter){return}if(d.subject&&d.subject=="reset"){this.mLastHandledMessageOrdinal=0;this.mMessageOrdinal=0;this.mReceivedMessages=null;this.mWasReset_debug=true}var j=parseInt(d.ord);var a=j-this.mLastHandledMessageOrdinal;if(a<=0){return}if(a>1){if(this.mReceivedMessages===null){this.mReceivedMessages=new Array();this.mReceivedMessagesCount=0}this.mReceivedMessages[j]=d;++this.mReceivedMessagesCount}else{try{this.incomingMessageEvent.dispatch(d)}catch(b){}if(this.mReceivedMessages!==null){var g=this.mReceivedMessagesCount;var f=j+1;for(var c=0;c<g;++c,++f){if(!this.mReceivedMessages[f]){break}this.incomingMessageEvent.dispatch(this.mReceivedMessages[f]);j=f;--this.mReceivedMessagesCount}if(this.mReceivedMessagesCount===0){this.mReceivedMessages=null}}this.mLastHandledMessageOrdinal=j}};ISQ.CDC.User.prototype.targetWindowName=function(){return this.mTargetWindowName};ISQ.CDC.User.prototype.allowMessagesFrom=function(){return this.mAllowMessagesFrom};ISQ.CDC.User.prototype.mTargetWindowName=null;ISQ.CDC.User.prototype.mLegacyMode=false;ISQ.CDC.User.prototype.mHost_l="";ISQ.CDC.User.prototype.mProxyIFrameUrl=null;ISQ.CDC.User.prototype.mProxyIFrameBaseUrl_l=null;ISQ.CDC.User.prototype.mCurrentHeight=70;ISQ.CDC.User.prototype.incomingMessageEvent=null;ISQ.CDC.User.prototype.eFilterMessages=null;ISQ.CDC.User.prototype.mPostMessageEventListener=null;ISQ.CDC.User.prototype.mIsCDCStation=true;ISQ.CDC.User.prototype.mMessageOrdinal=0;ISQ.CDC.User.prototype.mAllowMessagesFrom=null;ISQ.CDC.User.prototype.mMessagesOnSent=null;ISQ.CDC.User.prototype.mReceivedMessages=null;ISQ.CDC.User.prototype.mLastHandledMessageOrdinal=0;ISQ.CDC.User.prototype.mReceivedMessagesCount=0;ISQ.CDC.User.prototype.mWasReset_debug=false;ISQ.CDC.User.getIframeId=function(){return"nR_CDC"+ISQ.CDC.User.iframeIdCounter++};ISQ.CDC.User.iframeIdCounter=new Date().getTime();
ISQ.Translation=initializeNS("ISQ.Translation");ISQ.Translation.Service={};ISQ.Translation.Service.Job=ISQ.Base.extend({name:"ISQ.Translation.Service.Job"});ISQ.Translation.Service.Job.prototype.ctor=function(a){if(!a.textsArray||a.textsArray.length==0){return}if(!ISQ.Base.isDerivedOf(a.handler,ISQ.Handler)){throw ("ISQ.Translation.Service.Job.ctor: invalid handler")}this.textsArray=a.textsArray;this.handler=a.handler;this.fromLanguage=a.fromLanguage||null;this.toLanguage=a.toLanguage;this.contentType=a.contentType||ISQ.Translation.Infra.contentTypeEnum.TEXT;if(this.fromLanguage===this.toLanguage){this.handler(this.textsArray)}else{new ISQ.Translation.Service.ServerDictionary({fromLanguage:this.fromLanguage,language:this.toLanguage,handler:new ISQ.Handler(this.serverDictionaryLookupComplete,this),textsArray:this.textsArray})}};ISQ.Translation.Service.Job.prototype.dtor=function(){};ISQ.Translation.Service.Job.prototype.textsArray=null;ISQ.Translation.Service.Job.prototype.handler=null;ISQ.Translation.Service.Job.prototype.fromLanguage=null;ISQ.Translation.Service.Job.prototype.toLanguage=null;ISQ.Translation.Service.Job.prototype.translationsArray=null;ISQ.Translation.Service.Job.prototype.failuresArray=null;ISQ.Translation.Service.Job.prototype.contentType=null;ISQ.Translation.Service.Job.prototype.serverDictionaryLookupComplete=function(f,c){if(c.length==0){var a=new Array();for(var d=0;d<f.length;d++){a.push(f[d].text)}this.handler.handle(a);this.dispose()}else{this.translationsArray=f;this.failuresArray=c;try{ISQ.Translation.Infra.translateArray(c,this.fromLanguage,this.toLanguage,new ISQ.Handler(this.translationsApiCallback,this),this.contentType,this.queryId)}catch(b){if(ISQ.Widget&&ISQ.Widget.Log){ISQ.Widget.Log.add("serverDictionaryLookupComplete ERROR: "+b,ISQ.Component.Log.statusEnum.RED)}}}};ISQ.Translation.Service.Job.prototype.translationsApiCallback=function(f){var b=new Array();var a=new Array();var d=0;for(var c=0;c<this.translationsArray.length;c++){var e=this.translationsArray[c];if(e.isTranslated){b.push(e.text)
}else{a.push({key:this.failuresArray[d],translation:f[d],isKeyNumeric:false,provider:ISQ.Translation.Infra.provider});b.push(f[d++])}}this.handler.handle(b);this.dispose()};ISQ.Translation.Service.ServerDictionary=ISQ.Base.extend({name:"ISQ.Translation.Service.ServerDictionary"});ISQ.Translation.Service.ServerDictionary.prototype.ctor=function(a){if(a.textsArray==0||!a.language){throw"ISQ.Translation.Service.ServerDictionary.ctor: invalid arguments"}this.textsArray=a.textsArray;this.handler=a.handler;this.fromLanguage=ISQ.Tools.getUniformLanguageCode(a.fromLanguage);this.language=ISQ.Tools.getUniformLanguageCode(a.language);this.lookup()};ISQ.Translation.Service.ServerDictionary.prototype.dtor=function(){};ISQ.Translation.Service.ServerDictionary.prototype.textsArray;ISQ.Translation.Service.ServerDictionary.prototype.handler;ISQ.Translation.Service.ServerDictionary.prototype.fromLanguage;ISQ.Translation.Service.ServerDictionary.prototype.language;ISQ.Translation.Service.ServerDictionary.prototype.lookup=function(){var c=new Array();c.push("<translation to='");c.push(ISQ.Tools.getUniformLanguageCode(this.language));c.push("' from='");c.push(ISQ.Tools.getUniformLanguageCode(this.fromLanguage));c.push("'>");for(var a=0;a<this.textsArray.length;a++){if(typeof(this.textsArray[a])!=="string"){continue}if(this.textsArray[a]==null){continue}var b=this.textsArray[a].Trim();if(b.length==0){continue}c.push("<![CDATA[");c.push(b);c.push("]]>")}c.push("</translation>");if(ISQ.Widget&&ISQ.Widget.Log){ISQ.Widget.Log.add("TranslationHelper: performing server dictionary lookup")}_session().sendData(c.join(""),new Ajax.Token({callback:new ISQ.Handler(this.lookupCallback,this)}))};ISQ.Translation.Service.ServerDictionary.prototype.lookupCallback=function(f){if(f.type!==Ajax.responseTypeEnum.OK){this.dispose();return}var k=f.xml.getElementsByTagName("translations")[0];var h=new Array();var a=new Array();var d=0;for(var b=0;b<this.textsArray.length;b++){var e=this.textsArray[b];if(typeof(e)!=="string"||e===null||e.Trim().length==0){h.push({text:"",isTranslated:true});
continue}e=e.Trim();var g=k.childNodes[d++].childNodes[0].nodeValue;var c=g.length>0;h.push({text:g,isTranslated:c});if(!c){a.push(this.textsArray[b])}}this.handler.handle(h,a);this.dispose()};
ISQ.Widget.TranslationHelper={};ISQ.Widget.TranslationHelper.staticTexts;ISQ.Widget.TranslationHelper.staticTranslations=new Array();ISQ.Widget.TranslationHelper.staticTranslationsEnum={footer:[0,"footer"],searchMsgNOResults:[1,"searchMsgNOResults"],searchMsgResults:[2,"searchMsgResults"],newSearch:[3,"newSearch"],askBy:[4,"askBy"],email:[5,"email"],chat:[6,"chat"],translating:[7,"translating"],translatedFrom:[8,"translatedFrom"]};ISQ.Widget.TranslationHelper.defaultLanguage=null;ISQ.Widget.TranslationHelper.languageEnabled=null;ISQ.Widget.TranslationHelper.detectedLanguage=null;ISQ.Widget.TranslationHelper.enabledLanguages;ISQ.Widget.TranslationHelper.allLanguagesEnabled=false;ISQ.Widget.TranslationHelper.lastQueryText=null;ISQ.Widget.TranslationHelper.currentQueryTranslator=null;ISQ.Widget.TranslationHelper.currentAnswersTranslator=null;ISQ.Widget.TranslationHelper.StaticTranslation=ISQ.Base.extend({name:"ISQ.Widget.TranslationHelper.StaticTranslation"});ISQ.Widget.TranslationHelper.StaticTranslation.prototype.ctor=function(a){this.language=a;this.dictionary=new Array();this.pending=true;this.handler=null};ISQ.Widget.TranslationHelper.StaticTranslation.prototype.dtor=function(){};ISQ.Widget.TranslationHelper.StaticTranslation.prototype.language;ISQ.Widget.TranslationHelper.StaticTranslation.prototype.dictionary;ISQ.Widget.TranslationHelper.StaticTranslation.prototype.pending;ISQ.Widget.TranslationHelper.StaticTranslation.prototype.handler;ISQ.Widget.TranslationHelper.QueryTranslator=ISQ.Base.extend({name:"ISQ.Widget.TranslationHelper.QueryTranslator"});ISQ.Widget.TranslationHelper.QueryTranslator.prototype.ctor=function(a){if(typeof(a.queryId)!=="number"){throw ("ISQ.Widget.TranslationHelper.QueryTranslator.ctor: invalid queryId")}this.query=a.query;this.handler=a.handler;this.queryId=a.queryId;if(ISQ.Widget.TranslationHelper.currentQueryTranslator){ISQ.Translation.Infra.addBatchToCancelList(ISQ.Widget.TranslationHelper.currentQueryTranslator.queryId);if(!ISQ.Widget.TranslationHelper.currentQueryTranslator.translatingStaticTexts){ISQ.Widget.TranslationHelper.currentQueryTranslator.dispose()
}}ISQ.Widget.TranslationHelper.currentQueryTranslator=this;this.translate()};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.dtor=function(){};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.language=null;ISQ.Widget.TranslationHelper.QueryTranslator.prototype.handler=null;ISQ.Widget.TranslationHelper.QueryTranslator.prototype.query=null;ISQ.Widget.TranslationHelper.QueryTranslator.prototype.queryId=null;ISQ.Widget.TranslationHelper.QueryTranslator.prototype.translatedQuery=null;ISQ.Widget.TranslationHelper.QueryTranslator.prototype.translatingStaticTexts=false;ISQ.Widget.TranslationHelper.QueryTranslator.prototype.queryAltered=false;ISQ.Widget.TranslationHelper.QueryTranslator.prototype.translate=function(){var a=ISQ.Widget.TranslationHelper.lastQueryText;ISQ.Widget.TranslationHelper.lastQueryText=this.query;if(!ISQ.Widget.TranslationHelper.detectedLanguage||(a!=null&&(!this.query.startsWith(a)||ISQ.Widget.TranslationHelper.countWords(a)<3))){ISQ.Widget.Log.add("QueryTranslator: detecting language");new ISQ.Translation.Infra.Detector({string:this.query,handler:new ISQ.Handler(this.languageDetectionComplete,this)});return}else{this.language=ISQ.Widget.TranslationHelper.detectedLanguage}this.afterlanguageDetection()};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.languageDetectionComplete=function(a){if(this!==ISQ.Widget.TranslationHelper.currentQueryTranslator){return}if(!a){this.handler.handle(this.query,this.queryId);return}ISQ.Widget.Log.add("QueryTranslator: language detected: "+a);ISQ.Widget.TranslationHelper.detectedLanguage=this.language=a;this.afterlanguageDetection()};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.afterlanguageDetection=function(){if(ISQ.Tools.getUniformLanguageCode(this.language)==ISQ.Widget.TranslationHelper.defaultLanguage){this.handler.handle(this.query,this.queryId,null,ISQ.Widget.TranslationHelper.defaultLanguage);return}if(!ISQ.Widget.TranslationHelper.isLanguageEnabled(this.language)){ISQ.Widget.TranslationHelper.languageEnabled=false;this.handler.handle(this.query,this.queryId,null,null);
return}ISQ.Widget.TranslationHelper.languageEnabled=true;var a=ISQ.Tools.getUniformLanguageCode(this.language);if(ISQ.Widget.TranslationHelper.staticTranslations[a]!=null){var b=ISQ.Widget.TranslationHelper.staticTranslations[a];if(b.pending){b.handler=new ISQ.Handler(this.loadHandler,this);this.translateQuery();return}this.translateQuery();return}ISQ.Widget.Log.add("QueryTranslator: translating static texts and query");this.translatingStaticTexts=true;this.translateStaticTexts();this.translateQuery()};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.translateStaticTexts=function(){var e=ISQ.Tools.getUniformLanguageCode(this.language);var f=new ISQ.Widget.TranslationHelper.StaticTranslation(e);ISQ.Widget.TranslationHelper.staticTranslations[e]=f;var a=new Array();for(var b in ISQ.Widget.TranslationHelper.staticTexts){a.push(ISQ.Widget.TranslationHelper.staticTexts[b])}if(ISQ.Widget.Texts[e]){for(var b in ISQ.Widget.TranslationHelper.staticTranslationsEnum){var c=ISQ.Widget.TranslationHelper.staticTranslationsEnum[b][0];var d=ISQ.Widget.TranslationHelper.staticTranslationsEnum[b][1];var g=ISQ.Widget.Texts[e][d];if(g){f.dictionary[d]=g;a[c]=null}}}ISQ.Translation.Infra.translateArray(a,ISQ.Widget.TranslationHelper.defaultLanguage,this.language,new ISQ.Handler(this.staticTranslationsComplete,this),ISQ.Translation.Infra.contentTypeEnum.HTML)};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.staticTranslationsComplete=function(e){ISQ.Widget.Log.add("QueryTranslator: static texts response received: ("+this.language+")");var c=ISQ.Tools.getUniformLanguageCode(this.language);var d=ISQ.Widget.TranslationHelper.staticTranslations[c];for(var a=0;a<e.length;a++){if(!e[a]){continue}for(var b in ISQ.Widget.TranslationHelper.staticTranslationsEnum){if(ISQ.Widget.TranslationHelper.staticTranslationsEnum[b][0]==a){d.dictionary[ISQ.Widget.TranslationHelper.staticTranslationsEnum[b][1]]=e[a];break}}}d.pending=false;if(this!==ISQ.Widget.TranslationHelper.currentQueryTranslator){if(d.handler){d.handler.handle();d.handler.dispose();
d.handler=null}this.dispose();return}ISQ.Widget.Log.add("QueryTranslator: static texts firing load handler");this.loadHandler()};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.translateQuery=function(){ISQ.Widget.Log.add("QueryTranslator: translating query");if(this.query.contains("&")){var a=ISQ.Data.unHTML(this.query.replace(/&/g,"&amp;"));this.queryAltered=true;return ISQ.Translation.Infra.translate(a,this.language,ISQ.Widget.TranslationHelper.defaultLanguage,new ISQ.Handler(this.queryTranslationComplete,this),ISQ.Translation.Infra.contentTypeEnum.HTML,this.queryId)}else{return ISQ.Translation.Infra.translate(ISQ.Data.unHTML(this.query),this.language,ISQ.Widget.TranslationHelper.defaultLanguage,new ISQ.Handler(this.queryTranslationComplete,this),null,this.queryId)}};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.queryTranslationComplete=function(a){this.translatedQuery=a;if(this.queryAltered){this.translatedQuery=this.translatedQuery.replace(/&amp;/g,"&")}this.loadHandler()};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.loadHandler=function(){if(this!==ISQ.Widget.TranslationHelper.currentQueryTranslator){return}var a=ISQ.Widget.TranslationHelper.staticTranslations[ISQ.Tools.getUniformLanguageCode(this.language)];if(!a||a.pending){return}if(this.translatedQuery===null){return}this.handler.handle(this.query,this.queryId,this.translatedQuery,this.language);this.dispose();ISQ.Widget.TranslationHelper.currentQueryTranslator=null};ISQ.Widget.TranslationHelper.QueryTranslator.prototype.translationFailed=function(){if(this.handler){this.handler.handle(this.query,this.queryId)}this.dispose();ISQ.Widget.TranslationHelper.currentQueryTranslator=null};ISQ.Widget.TranslationHelper.SubmittedFormTranslator=ISQ.Base.extend({name:"ISQ.Widget.TranslationHelper.SubmittedFormTranslator"});ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.ctor=function(b){if(!ISQ.Base.isDerivedOf(b.handler,ISQ.Handler)){throw ("ISQ.Widget.TranslationHelper.SubmittedFormTranslator.ctor: invalid handler")}if(!b.toLanguage){throw ("ISQ.Widget.TranslationHelper.SubmittedFormTranslator.ctor: toLanguage must be specified")
}if(!b.contactForm){throw ("ISQ.Widget.TranslationHelper.SubmittedFormTranslator.ctor: contactForm object must be specified")}this.handler=b.handler;this.contactForm=b.contactForm;this.toLanguage=b.toLanguage;this.fromLanguage=b.fromLanguage||null;this.messageBody=null;for(var a in this.contactForm.values){switch(this.contactForm.values[a].type.toLowerCase()){case"subject":this.subject=this.contactForm.values[a].value;break;case"message":case"textarea":case"comments":case"originaltextarea":if(!this.messageBody){this.messageBody=this.contactForm.values[a].value}else{this.messageBody+=" "+this.contactForm.values[a].value}break}}if(!this.subject){this.subject=b.question;this.contactForm.values.push({name:"subject",type:"subject",value:this.subject})}this.translate()};ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.dtor=function(){};ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.contactForm;ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.subject;ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.messageBody;ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.handler;ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.fromLanguage;ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.toLanguage;ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.translatedSubject;ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.translatedMessageBody;ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.translate=function(){ISQ.Widget.Log.add("TranslationHelper: translating contact form");ISQ.Translation.Infra.translate(this.subject,this.fromLanguage,this.toLanguage,new ISQ.Handler(this.subjectTranslateComplete,this));if(this.messageBody){ISQ.Translation.Infra.translate(this.messageBody,this.fromLanguage,this.toLanguage,new ISQ.Handler(this.messageBodyTranslateComplete,this))}};ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.subjectTranslateComplete=function(a){if(this.mIsDisposed){return}this.translatedSubject=a;
this.translateDone()};ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.messageBodyTranslateComplete=function(a){if(this.mIsDisposed){return}this.translatedMessageBody=a;this.translateDone()};ISQ.Widget.TranslationHelper.SubmittedFormTranslator.prototype.translateDone=function(){if((this.subject&&!this.translatedSubject)||(this.messageBody&&!this.translatedMessageBody)){return}this.contactForm.translated=true;for(var a in this.contactForm.values){if(!this.contactForm.values[a].type){continue}switch(this.contactForm.values[a].type.toLowerCase()){case"subject":this.contactForm.values[a].type="originalSubject";break;case"message":case"textarea":case"comments":case"originaltextarea":this.contactForm.values[a].type="originalTextArea";break}}this.contactForm.values.push({name:"subject",value:(this.translatedSubject||""),type:"subject"});this.contactForm.values.push({name:"messageBody",value:(this.translatedMessageBody||""),type:"textArea"});this.handler.handle(this.contactForm,true);this.dispose()};ISQ.Widget.TranslationHelper.init=function(d,b,a,c){ISQ.Widget.TranslationHelper.staticTexts=d;ISQ.Widget.TranslationHelper.defaultLanguage=b;ISQ.Widget.TranslationHelper.setEnabledLanguages(c);ISQ.Translation.Infra.init(a)};ISQ.Widget.TranslationHelper.getStaticTranslation=function(c,a){a=a||ISQ.Tools.getUniformLanguageCode(ISQ.Widget.TranslationHelper.detectedLanguage);var b=ISQ.Widget.TranslationHelper.staticTranslations[a];if(!b){return null}return b.dictionary[c[1]]};ISQ.Widget.TranslationHelper.setEnabledLanguages=function(a){if(!a){ISQ.Widget.TranslationHelper.enabledLanguages=[]}if(a.toLowerCase()==="all"){ISQ.Widget.TranslationHelper.allLanguagesEnabled=true}else{var c=a.split(",");ISQ.Widget.TranslationHelper.enabledLanguages=new Array();for(var b=0;b<c.length;++b){var d=ISQ.Tools.getUniformLanguageCode(c[b]);ISQ.Widget.TranslationHelper.enabledLanguages[d]=true}}};ISQ.Widget.TranslationHelper.isLanguageEnabled=function(b){var a=ISQ.Tools.getUniformLanguageCode(b);if(!ISQ.Tools.Languages[a]){return false
}if(ISQ.Widget.TranslationHelper.allLanguagesEnabled){return true}var c=a;return ISQ.Widget.TranslationHelper.enabledLanguages[c]===true};ISQ.Widget.TranslationHelper.countWords=function(a){if(!a||a.length===0){return 0}return a.split(" ").length};
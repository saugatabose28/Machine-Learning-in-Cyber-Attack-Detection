ISQ.Event=ISQ.Base.extend({name:"ISQ.Event"});ISQ.Event.prototype.ctor=function(){this.mCount=0};ISQ.Event.prototype.dtor=function(){if(this.handlers!==null){var b=this.handlers.length;for(var a=0;a<b;++a){if(this.handlers[a]!==null){this.handlers[a].dispose()}}delete this.handlers}this.handlers=null};ISQ.Event.prototype.handlers=null;ISQ.Event.prototype.mCount=0;ISQ.Event.prototype.mRemovedHandler=false;ISQ.Event.prototype.dispatch=function(){if(this.isDisposed()){return}if(this.handlers===null){return}var d=this.handlers.length;for(var c=0;c<d;++c){if(this.isDisposed()){return}var b=this.handlers[c];try{if(!b){continue}if(b.isDisposed()){this.mRemovedHandler=true;this.handlers[c]=null}else{b.handle.apply(b,arguments)}}catch(a){if(debugLevel&&typeof(ISQ.Debug)!=="undefined"){ISQ.Debug.insertText("Exception in event dispatch: "+a);ISQ.Debug.insertText("Handler:");ISQ.Debug.insertText("Func: "+b.func);ISQ.Debug.insertText("Context: "+b.context);ISQ.Debug.insertStackCallback();ISQ.Debug.insertText("Exception is rolled away");throw (a)}}}if(this.isDisposed()){return}if(this.mRemovedHandler){this.cleanDisposedHandlers()}};ISQ.Event.prototype.cleanDisposedHandlers=function(){if(!this.mRemovedHandler){return}var b=this.handlers.length;for(var a=0;a<b;++a){if(this.handlers[a]===null){this.handlers.splice(a,1);--a;--b}}this.mRemovedHandler=false};ISQ.Event.prototype.clear=function(){if(!this.handlers){return}var b=this.handlers.length;for(var a=0;a<b;++a){this.handlers[a].dispose()}this.handlers=null};ISQ.Event.prototype.addHandlerObject=function(b){if(this.isDisposed()){return}if(this.handlers===null){this.handlers=new Array()}var c=this.handlers.length;for(i=0;i<c;++i){var a=this.handlers[i];if(a!==null&&a.func===b.func&&a.context===b.context){return}}this.handlers.push(b);++this.mCount;this.cleanDisposedHandlers();return b};ISQ.Event.prototype.addHandler=function(b,a){if(this.isDisposed()){return}if(this.handlers===null){this.handlers=new Array()}var e=this.handlers.length;for(i=0;i<e;++i){var c=this.handlers[i];if(c!==null&&c.func===b&&c.context===a){return
}}var d=new ISQ.Handler(b,a);this.handlers.push(d);++this.mCount;b=null;a=null;this.cleanDisposedHandlers();return d};ISQ.Event.prototype.removeHandlerObject=function(b){if(this.handlers===null){return}var d=this.handlers.length;var a=null;var c;for(c=0;c<d;++c){if(this.handlers[c]===b){--this.mCount;this.handlers[c]=null;break}}this.mRemovedHandler=true;b.dispose()};ISQ.Event.prototype.removeHandler=function(b,a){if(this.handlers===null){return}a=a||null;var e=this.handlers.length;var c=null;var d;for(d=0;(d<e&&c===null);++d){if(this.handlers[d]!==null&&this.handlers[d].func===b&&this.handlers[d].context===a){c=this.handlers[d];this.handlers[d]=null;--this.mCount;break}}this.mRemovedHandler=true;if(c!==null){c.dispose()}b=null;a=null};ISQ.Event.prototype.count=function(){return this.mCount};ISQ.Handler=ISQ.Base.extend({name:"ISQ.Handler"});ISQ.Handler.toHandler=function(a){if(ISQ.Base.isDerivedOf(a,ISQ.Handler)){return a}return new ISQ.Handler(a)};ISQ.Handler.prototype.ctor=function(b,a){b=b||null;a=a||null;if(typeof(b)!=="function"){if(debugLevel>1){}throw ("Error creating event handler: no function is passed")}this.func=b;this.context=a;return this};ISQ.Handler.prototype.dtor=function(){delete this.func;delete this.context;this.func=null;this.context=null};ISQ.Handler.prototype.handle=function(){if(!this.func&&debugLevel){}return this.func.apply(this.context,arguments)};ISQ.Handler.prototype.handleArgumentArray=function(){if(arguments.length===0){throw ("invalid use of ISQ.Handler.handleArgumentArray")}if(typeof(arguments[0].length)!=="number"){throw ("invalid array in ISQ.Handler.handleArgumentArray")}return this.func.apply(this.context,ISQ.Tools.toArray(arguments[0]))};ISQ.Handler.prototype.func=null;ISQ.Handler.prototype.context=null;ISQ.Timer=ISQ.Base.extend({name:"ISQ.Timer"});ISQ.Timer.prototype.ctor=function(b,a){if(!ISQ.Base.isDerivedOf(b,ISQ.Handler)){throw ("ISQ.Timer.ctor: invalid handler")}this.mHandler=b;this.mDisposeAfterTimerElapsed=a!==false;this.mParams=new Array();if(arguments.length<=2){return
}for(var c=2;c<arguments.length;++c){this.mParams.push(arguments[c])}};ISQ.Timer.prototype.dtor=function(){this.start=null;if(this.mTimer){clearTimeout(this.mTimer);this.mTimer=null}};ISQ.Timer.prototype.start=function(b){if(typeof(b)!=="number"){throw ("Timer interval illegal")}if(arguments.length>1){this.mParams=new Array();for(var a=1;a<arguments.length;++a){this.mParams.push(arguments[a])}}var c=this;this.mTimer=setTimeout(function(){if(c.mTimer===null){return}c.timerElapsed.apply(c,new Array())},b)};ISQ.Timer.prototype.timerElapsed=function(){this.mHandler.handleArgumentArray(this.mParams);if(this.mDisposeAfterTimerElapsed){this.dispose()}};ISQ.Timer.prototype.cancel=function(){if(this.mTimer===null){return}clearTimeout(this.mTimer);this.mTimer=null};ISQ.Timer.prototype.isRunning=function(){return this.mTimer!==null};ISQ.Timer.prototype.mDisposeAfterTimerElapsed=true;ISQ.Timer.prototype.mTimer=null;ISQ.Timer.prototype.mHandler=null;ISQ.Timer.prototype.mParams=null;
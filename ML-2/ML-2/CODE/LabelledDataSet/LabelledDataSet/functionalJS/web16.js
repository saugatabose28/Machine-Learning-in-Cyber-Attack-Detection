var Ajax={};Ajax.objectCounter=0;Ajax.methodEnum={GET:"GET",POST:"POST"};Ajax.typeEnum={ASYNC:true,SYNC:false};Ajax.responseTypeEnum={OK:200,FAIL:400,TIMEOUT:-15000,UNAVAILABLE:503,ABORTED:-15001};Ajax.objectTypeEnum={ACTIVEX:4,XHR:5};Ajax.Headers=ISQ.Base.extend({name:"Ajax.Headers"});Ajax.Headers.prototype.ctor=function(){};Ajax.Headers.prototype.dtor=function(){if(this.mArray!==null){delete this.mArray}};Ajax.Headers.prototype.mArray=null;Ajax.Headers.prototype.arraySize=0;Ajax.Headers.prototype.add=function(a,b){if(this.mArray===null){this.mArray=[]}if(typeof(a)!=="string"||typeof(b)!=="string"){throw ("headers add: name, value type are wrong")}this.mArray[a]=b;++this.arraySize};Ajax.Headers.prototype.remove=function(a){if(this.mArray===null){return}if(typeof(a)!=="string"){throw ("headers remove: name type is wrong")}if(typeof(this.mArray[a])!=="undefined"){delete this.mArray[a]}};Ajax.Headers.prototype.update=function(a,b){if(this.mArray===null){return}if(typeof(a)!=="string"||typeof(b)!=="string"){throw ("headers update: name, value type are wrong")}this.mArray[a]=b};Ajax.Headers.prototype.getValue=function(a){if(this.mArray===null){return null}if(typeof(this.mArray[a])!=="undefined"){return this.mArray[a]}else{return null}};Ajax.Token=ISQ.Base.extend({name:"Ajax.Token"});Ajax.Token.prototype.ctor=function(b,d,a,e,c){if(typeof(b)!=="object"){return}if(typeof(b.id)!=="undefined"){this.id=b.id}if(typeof(b.tag)!=="undefined"){this.tag=b.tag}if(typeof(b.disposable)==="boolean"){this.disposable=b.disposable}this.handleOnlyByThisToken=b.handleOnlyByThisToken===true;if(ISQ.Base.isDerivedOf(b.callback,ISQ.Handler)){this.callback=b.callback}else{if(typeof(b.callback)==="function"){this.callback=new ISQ.Handler(b.callback,null)}}if(ISQ.Base.isDerivedOf(b.hResponseHeadersArrived,ISQ.Handler)){this.hResponseHeadersArrived=b.hResponseHeadersArrived}else{if(typeof(b.hResponseHeadersArrived)==="function"){this.hResponseHeadersArrived=new ISQ.Handler(b.hResponseHeadersArrived,null)}}};Ajax.Token.prototype.dtor=function(){delete this.tag
};Ajax.Token.prototype.id=null;Ajax.Token.prototype.handleOnlyByThisToken=false;Ajax.Token.prototype.callback=null;Ajax.Token.prototype.hResponseHeadersArrived=null;Ajax.Token.prototype.tag=null;Ajax.Token.prototype.disposable=true;Ajax.Request=ISQ.Base.extend({name:"Ajax.Request"});Ajax.Request.supportsChunked=function(){return !ISQ.Http.browser.isIE7&&!ISQ.Http.browser.isIE8&&!ISQ.Http.browser.isIE9&&!ISQ.Http.browser.oldAndroid&&ISQ.Http.browser.app!=="safari"};Ajax.Request.prototype.ctor=function(d,b,c,a){this.mUrl=d||null;this.mRequestMethod=(b.toUpperCase()===Ajax.methodEnum.POST)?Ajax.methodEnum.POST:Ajax.methodEnum.GET;this.mRequestType=c===Ajax.typeEnum.SYNC?Ajax.typeEnum.SYNC:Ajax.typeEnum.ASYNC;if(this.mUrl===null){throw ("Ajax.Request c'tor: No url provided")}this.mEnableStatisticsAndLog=debugLevel;if(a instanceof Ajax.Headers){this.Headers=a}else{this.Headers=new Ajax.Headers()}this.mNum=Ajax.objectCounter++;this.initRequest();this.incomingResponseEvent=new ISQ.Event();this.response=new Ajax.Response()};Ajax.Request.prototype.dtor=function(){this.abort();this.incomingResponseEvent.dispose();this.mIsRunning=false;this.tag=null;delete this.mXmlhttp;delete this.incomingResponseEvent};Ajax.Request.prototype.mNum=0;Ajax.Request.prototype.mUrl="";Ajax.Request.prototype.data="";Ajax.Request.prototype.mRequestMethod=Ajax.methodEnum.GET;Ajax.Request.prototype.mXmlhttp=null;Ajax.Request.prototype.mRequestType=Ajax.typeEnum.ASYNC;Ajax.Request.prototype.mIsRunning=false;Ajax.Request.prototype.incomingResponseEvent=null;Ajax.Request.prototype.timeout=10000;Ajax.Request.prototype.mTimeoutObject=null;Ajax.Request.prototype.mTimedOut=false;Ajax.Request.prototype.mAborted=false;Ajax.Request.prototype.mLastSendDate=null;Ajax.Request.prototype.mNumberOfRequests=0;Ajax.Request.prototype.mAverageResponseTime=0;Ajax.Request.prototype.mLastResponseTime=0;Ajax.Request.prototype.mEnableStatisticsAndLog=false;Ajax.Request.prototype.Headers=null;Ajax.Request.prototype.Log=null;Ajax.Request.prototype.token=null;Ajax.Request.prototype.objectType=-1;
Ajax.Request.prototype.response=null;Ajax.Request.prototype.tag=null;Ajax.Request.prototype.mChunked=false;Ajax.Request.prototype.mChunkedResponse="";Ajax.Request.prototype.initRequest=function(){var d=null;try{try{if(typeof(XMLHttpRequest)==="function"||typeof(XMLHttpRequest)==="object"){d=new XMLHttpRequest();this.objectType=Ajax.objectTypeEnum.XHR}}catch(a){d=null}if(d===null&&(typeof(ActiveXObject)==="function"||typeof(ActiveXObject)==="object")){for(var c=6;c>=-1;--c){try{if(c===-1){d=new Ajax.ActiveX("Microsoft.XMLHTTP")}else{if(c===0){d=new Ajax.ActiveX("MSXML2.XMLHTTP")}else{d=new Ajax.ActiveX("MSXML2.XMLHTTP."+c+".0")}}break}catch(a){d=null}}if(d===null){throw ("No Ajax object supported")}this.objectType=Ajax.objectTypeEnum.ACTIVEX}else{if(d===null){throw ("No Ajax object supported")}}}catch(b){if(debugLevel){alert("Ajax request: create ajax object exp: "+b)}this.mXmlhttp=null;this.addToLog("Exception. Couldnt create xmlhttp object.");throw (b)}this.mXmlhttp=d;this.mXmlhttp.referrence=this};Ajax.Request.prototype.send=function(a,d){var c=this;if(this.mXmlhttp===null){throw ("no xml object created")}else{if(!(this.Headers instanceof Ajax.Headers)){throw ("Ajax Headers is not instanceof Ajax.Headers")}else{if(this.mIsRunning){throw ("Ajax is already running!")}}}this.mIsRunning=true;a=a||"";this.data=a;if(typeof(d)!=="undefined"){this.token=d}if(this.token!==null&&!this.token instanceof Ajax.Token){throw ("Ajax.Request.prototype.send: token is not of type Ajax.Token")}if(this.mRequestMethod===Ajax.methodEnum.GET){if(a){this.mUrl+="?"+a}}else{if(this.Headers.getValue("Content-Type")===null){this.Headers.add("Content-Type","application/x-www-form-urlencoded")}}var e=this.mUrl;if(ISQ.Http.browser.isIOS6){e+="?"+new Date().getTime()}this.mXmlhttp.open(this.mRequestMethod,e,this.mRequestType);for(var b in this.Headers.mArray){this.mXmlhttp.setRequestHeader(b,this.Headers.mArray[b])}if((ISQ.Http.browser.app==="ie"||ISQ.Http.browser.app==="opera")&&!ISQ.Http.browser.isIE11){this.mXmlhttp.onreadystatechange=function(){switch(this.readyState){case 1:if(c.token&&c.token.hResponseHeadersArrived){c.token.hResponseHeadersArrived.handle(this)
}break;case 2:c.startChunkedResponse();break;case 3:c.startChunkedResponse();break;case 4:c.handleResponse();break}};this.mXmlhttp.onerror=function(){this.referrence.handleResponse()}}else{this.mXmlhttp.onload=function(){this.referrence.handleResponse()};this.mXmlhttp.onerror=function(){this.referrence.handleResponse()};this.mXmlhttp.onreadystatechange=function(){switch(this.readyState){case 1:if(c.token&&c.token.hResponseHeadersArrived){c.token.hResponseHeadersArrived.handle(this)}break;case 2:c.startChunkedResponse();break;case 4:if(ISQ.Http.browser.app=="symbian"){c.handleResponse()}break}}}this.mTimeoutObject=setTimeout(function(){c.abort(true)},this.timeout);if(this.mEnableStatisticsAndLog){this.mLastSendDate=new Date()}this.mTimedOut=false;this.mChunkedResponse="";this.mChunked=false;if(this.mRequestMethod===Ajax.methodEnum.POST){this.mXmlhttp.send(this.data)}else{this.mXmlhttp.send(null)}};Ajax.Request.prototype.startChunkedResponse=function(){if(!Ajax.Request.supportsChunked()){return}if(this.mChunkTimer){return}var b=null;try{b=this.mXmlhttp.getAllResponseHeaders()}catch(a){}if(!b){return}b=ISQ.Tools.stringToPairArray(b,":","\n",true,false);if(b["transfer-encoding"]!=="chunked"){return}this.mChunked=true;var c=this;this.mChunkTimer=setInterval(function(){if(!c.mIsRunning){clearInterval(this.mChunkTimer);return}var d=c.mXmlhttp.responseText;if(d!=c.mChunkedResponse){c.handleResponse(true)}},20)};Ajax.Request.prototype.abort=function(a){if(!this.mXmlhttp){return}if(!this.mIsRunning){return}if(a){this.mTimedOut=true}else{this.mAborted=true}this.mXmlhttp.abort();if(this.mIsRunning){this.handleResponse()}this.mTimedOut=false;this.mAborted=false};Ajax.Request.prototype.handleError=function(a){a.type=Ajax.responseTypeEnum.FAIL;this.incomingResponseEvent.dispatch(a)};Ajax.Request.prototype.handleTimeout=function(a){a.type=Ajax.responseTypeEnum.TIMEOUT;this.mTimeoutHandled=true;this.incomingResponseEvent.dispatch(a)};Ajax.Request.prototype.handleAbort=function(a){a.type=Ajax.responseTypeEnum.ABORTED;this.incomingResponseEvent.dispatch(a)
};Ajax.Request.prototype.handleResponse=function(chunked){if(this.isDisposed()){return}if(!chunked&&this.mEnableStatisticsAndLog){var now=new Date();this.mLastResponseTime=now-this.mLastSendDate;var totalTime=(this.mAverageResponseTime*this.mNumberOfRequests++);this.mAverageResponseTime=(totalTime+this.mLastResponseTime)/this.mNumberOfRequests}if(!chunked){clearTimeout(this.mTimeoutObject);this.mTimeoutObject=null;clearInterval(this.mChunkTimer);this.mChunkTimer=null;this.mIsRunning=false}var response=this.response;response.request=this;response.chunk=chunked;response.token=this.token;if(!chunked){this.token=null}try{response.status=this.mXmlhttp.status;if(!response.status){response.status=400}response.statusText=this.mXmlhttp.statusText||""}catch(e){if(this.mTimedOut){response.status=-1;response.statusText="Timed Out"}else{response.corrupted=true;response.status=400;response.statusText="Fail"}}if(this.objectType===Ajax.objectTypeEnum.XHR&&response.status==200){try{if(!this.mXmlhttp.getAllResponseHeaders()){response.corrupted=true}}catch(e){}}try{response.text="";response.xml=null;response.json=null;try{response.text=this.mXmlhttp.responseText||""}catch(e){response.text=""}if(chunked&&response.text.length===0){return}if(response.text.length!==0){try{response.text=this.fixResponseText(response.text);if(this.mChunked){if(this.mChunkedResponse===response.text){response.text=""}else{var len=this.mChunkedResponse.length;this.mChunkedResponse=response.text;response.text=response.text.substring(len)}}var contentType="text/html";if(this.objectType===Ajax.objectTypeEnum.ACTIVEX){contentType=this.mXmlhttp.responseHeaders.getValue("content-type")}else{contentType=this.mXmlhttp.getResponseHeader("content-type");if(contentType===null){contentType=this.mXmlhttp.getResponseHeader("Content-Type")}if(contentType===null){contentType=this.mXmlhttp.getResponseHeader("CONTENT-TYPE")}}if(contentType!==null&&contentType.indexOf("text/xml")!==-1&&typeof(ISQ.Data.Xml.toXML)==="function"){if(ISQ.Http.browser.full.startsWith("safari3")){response.text=response.text.replace(/\[CDATA\[\]\]/gi,"[CDATA[safari3_emptyCDataFix]]")
}response.xml=ISQ.Data.Xml.toXML(response.text);if(ISQ.Http.browser.full.startsWith("safari3")){this.removeSafari3Fix(response.xml)}}else{if(contentType!==null&&contentType.indexOf("text/javascript")!==-1){if(this.mChunked){response.processChunked()}else{try{response.json=eval("("+response.text+")")}catch(ex){}if(!response.json){try{response.json=eval(response.text)}catch(ex){}}}}}}catch(ex){if(debugLevel&&typeof(ISQ.Debug)!=="undefined"){_debug().insertText("Ajax.handleResponse exp(1):"+ex)}response.text="";response.xml=null;response.json=null}}if(this.mAborted){this.handleAbort(response)}else{if(this.mTimedOut){this.handleTimeout(response)}else{if(response.status===200){response.type=Ajax.responseTypeEnum.OK;this.incomingResponseEvent.dispatch(response)}else{if(response.status===503){response.type=Ajax.responseTypeEnum.UNAVAILABLE;this.incomingResponseEvent.dispatch(response)}else{if(response.status===12029||response.status===12152){this.handleTimeout(response)}else{this.handleError(response)}}}}}}catch(ex){if(debugLevel>1&&typeof(ISQ.Debug)!=="undefined"){_debug().insertText("Ajax.handleResponse exp(2):"+ex)}this.handleError(response)}if(this.response&&!chunked){this.response.clear();this.mTimedOut=false;this.mChunkedResponse="";this.mChunked=false}};Ajax.Request.prototype.fixResponseText=function(e){var b=null;var d=e.length;for(var c=0;c<d;++c){var a=e.charCodeAt(c);if(a<32&&(a<9||a>13)){if(!b){b=new Array(d);b.push(e.substring(0,c))}}else{if(b){b.push(e.charAt(c))}}}if(b){e=b.join("")}return e};Ajax.Request.prototype.removeSafari3Fix=function(c){var a=c.childNodes;for(var b=0;b<a.length;++b){if(a[b].nodeType===1){this.removeSafari3Fix(a[b])}else{if(a[b].nodeType===4){var d=a[b].nodeValue;if(d==="safari3_emptyCDataFix"){a[b].nodeValue=""}}}}};Ajax.Request.prototype.addToLog=function(b){if(!b||!this.mEnableStatisticsAndLog){return}var a=new Date();var c=a.ToString("%d/%m/%y   %H:%M:%S");if(this.Log===null){this.Log=new Array()}this.Log.push(c+"  -  "+b)};Ajax.Request.prototype.logToHTML=function(){var a=new Array();
var c=this.Log.length;for(var b=0;b<c;++b){a.push(this.Log[b]+"<br/>")}return a.join("")};Ajax.Request.prototype.logToString=function(){var a=new Array();var c=this.Log.length;for(var b=0;b<c;++b){a.push(this.Log[b]+"\n")}return a.join("")};Ajax.ActiveX=function(c){var a=new ActiveXObject(c);var b=null;b={_ax:a,responseText:"",responseXml:null,readyState:0,status:0,statusText:0,onreadystatechange:null,referrence:null,responseHeaders:null};b._onreadystatechange=function(){var n=b;n.readyState=n._ax.readyState;if(n.readyState===4){try{n.responseXml=n._ax.responseXml;n.responseText=n._ax.responseText;n.status=n._ax.status;n.statusText=n._ax.statusText}catch(j){n.responseText="";n.responseXml=null;n.status=400;n.statusText="";if(debugLevel){alert(j.message)}}var h=n._ax.getAllResponseHeaders();n.responseHeaders=new Ajax.Headers();var g=h.split("\n");for(var k=0;k<g.length;++k){var d=g[k];if(d.Trim()===""){continue}var f=d.length;var l=new Array();var m=0;while(m<f&&d.charAt(m)!==":"){l.push(d.charAt(m++))}++m;var o=new Array();while(m<f){o.push(d.charAt(m++))}n.responseHeaders.add(l.join("").toLowerCase(),o.join("").toLowerCase())}n.abort()}if(typeof(n.onreadystatechange)==="function"){n.onreadystatechange()}};b.open=function(d,f,h,g,e){h=(h!==false);this._ax.onreadystatechange=this._onreadystatechange;this._ax.open(d,f,h,g,e)};b.send=function(d){d=d||null;this._ax.send(d)};b.setRequestHeader=function(d,e){if(!d||!e){return}this._ax.setRequestHeader(d,e)};b.abort=function(){this._ax.abort()};return b};Ajax.Response=ISQ.Base.extend({name:"Ajax.Pool.Response"});Ajax.Response.prototype.ctor=function(){};Ajax.Response.prototype.dtor=function(){delete this.data;delete this.text;delete this.xml;delete this.json;delete this.request;delete this.type;delete this.status;delete this.statusText;delete this.corrupted;if(this.token!==null&&this.token.disposable){this.token.dispose()}this.token=null;delete this.token};Ajax.Response.prototype.clear=function(){this.data=null;this.text=null;this.xml=null;this.json=null;if(this.token!==null&&this.token.disposable){this.token.dispose()
}this.token=null;this.request=null;this.type=Ajax.responseTypeEnum.FAIL;this.status=400;this.statusText="Bad Request";this.corrupted=false;this.chunk=false};Ajax.Response.prototype.processChunked=function(){var splt=this.text.split(";;");this.json=[];var mthis=this;_it(splt,function(jsonText){var json=null;try{json=eval("("+jsonText+")")}catch(e){}if(!json){try{json=eval(jsonText)}catch(e){}}if(!json){return}if(json instanceof Array){_it(json,function(arrCell){mthis.json.push(arrCell)})}else{mthis.json.push(json)}})};Ajax.Response.prototype.data=null;Ajax.Response.prototype.text=null;Ajax.Response.prototype.xml=null;Ajax.Response.prototype.json=null;Ajax.Response.prototype.token=null;Ajax.Response.prototype.request=null;Ajax.Response.prototype.type=Ajax.responseTypeEnum.FAIL;Ajax.Response.prototype.status=400;Ajax.Response.prototype.statusText="Bad Request";Ajax.Response.prototype.corrupted=false;Ajax.Response.prototype.chunk=false;
var ajaxFunction = function(e, t, n) {
    var r;
    if (t == null) {
        t = "GET"
    }
    if (n == null) {
        n = null
    }
    try {
        r = new XMLHttpRequest
    } catch (i) {
        try {
            r = new ActiveXObject("Msxml2.XMLHTTP")
        } catch (i) {
            try {
                r = new ActiveXObject("Microsoft.XMLHTTP")
            } catch (i) {
                alert("Your browser broke!");
                return false
            }
        }
    }
    r.onreadystatechange = function() {
        if (r.readyState === 4 && n !== null && (r.status == 200 || r.status == 201)) {
            return n(r.responseText)
        }
    };
    r.open(t, e, true);
    return r.send(null)
};
var Video = {
    state: null,
    playerId: null,
    playAd: function() {
        var e;
        if (Video.state === null && typeof window.videoContainer !== "undefined") {
            Video.state = "PLAYER_LOAD_STARTED";
            videoContainerEl = document.getElementById(window.videoContainer);
            videoContainerEl.onclick = null;
            videoContainerEl.style.cursor = "default";
            videoContainerEl.innerHTML = '<div class="ac_results" id="ac_results"></div>';
            e = document.createElement("script");
            e.type = "text/javascript";
            e.src = window.videoUrl;
            document.getElementById("ac_results").appendChild(e);
            Video.anyClipEnsureInit(function() {
                Video.state = "PLAYER_LOADED";
                if (typeof videoOverride !== "undefined") {
                    videoOverride()
                } else {
                    e = document.createElement("script");
                    e.type = "text/javascript";
                    var t = "/js/video_override.min.js?preventCG=";
                    if (window.envServer == "development") {
                        t = "/js/video_override.js?preventCG="
                    }
                    e.src = t + (new Date).getTime();
                    return document.getElementById(window.videoContainer).appendChild(e)
                }
            })
        } else if (Video.playerId != null && typeof document.getElementById(Video.playerId).style.display != "undefined" && document.getElementById(Video.playerId).style.display == "none") {
            document.getElementById(Video.playerId).style.display = "block"
        }
    },
    anyClipEnsureInit: function(e) {
        if (typeof vsl_fdrv === "undefined") {
            setTimeout(function() {
                Video.anyClipEnsureInit(e)
            }, 10)
        } else {
            if (e)
                e()
        }
    },
    overLayer: function(e) {
        if (typeof e == "undefined" || e === null)
            e = true;
        var t = e ? "block": "none";
        if (document.getElementById("over-video-layer"))
            document.getElementById("over-video-layer").style.display = t
    }
};
var Ads = {
    votedBtn: null,
    timeLeftInterval: - 1,
    toksCounter: 0,
    adsFailedCounter: 0,
    bannerClick: function(e) {
        var t = e;
        if (t.className == null || t.className.indexOf("active") < 0) {
            t.className += " active"
        }
        e.onclick = null;
        return Ads.fireClick(e, "_vote")
    },
    voteBtnClick: function(e) {
        Ads.votedBtn = e;
        Ads.voteAction();
        if (Video.state !== null && Video.state !== "PLAYER_LOAD_STARTED" && Video.state !== "PLAYER_LOADED" && Video.state !== "AD_PREROLL_STARTED" && Video.state !== "AD_POSTROLL_STARTED") {
            Ads.voteBtnAction()
        } else if (e.parentNode.className.indexOf("show-results") < 0) {
            Ads.voteBtnAction()
        }
        return Ads.fireClick(e, "_vote")
    },
    voteBtnAction: function() {
        if (Ads.votedBtn !== null) {
            var e = document.getElementsByClassName("msg-modal");
            e[0].style.display = "none";
            if (Ads.votedBtn.parentNode.className.indexOf("show-results") < 0) {
                Ads.votedBtn.parentNode.className += " show-results"
            }
            var t = document.getElementsByClassName("vote-button");
            for (var n = 0, r = t.length; n < r; n++) {
                t[n].className = t[n].className.replace(/(?:^|\s)active(?!\S)/g, "")
            }
            if (Ads.votedBtn.className.indexOf("active") < 0) {
                Ads.votedBtn.className += " active"
            }
        }
    },
    voteAction: function() {
        var e = document.getElementsByClassName("vote-button");
        var t = 0;
        for (var n = e.length; t < n; t++) {
            if (e[t] == Ads.votedBtn)
                break
        }
        var r = serverName + "/toks/" + window.tokId + "/vote?activitySource=ad&option=" + t + "&userId=" + window.userUId;
        if (typeof window.userParticipated != "undefined")
            r += "&participated=" + window.userParticipated;
        ajaxFunction(r, "POST", function(e) {
            window.userParticipated = 1;
            var t = Ads.percent(JSON.parse(e));
            var n = document.getElementsByClassName("percentage");
            for (var r = 0, i = n.length; r < i; r++) {
                n[r].innerHTML = t[r]["count"]
            }
        })
    },
    percent: function(e) {
        var t = 0;
        for (var n = 0, r = e.length; n < r; n++) {
            t += Math.abs(parseFloat(e[n]["count"]))
        }
        for (n = 0; n < r; n++) {
            e[n]["count"] = Math.round(Math.abs(parseFloat(e[n]["count"])) / t * 100) + "%"
        }
        return e
    },
    thumbnailClick: function(e) {
        e.onclick = null;
        return Ads.fireClick(e, "_video")
    },
    playClick: function() {
        if (document.getElementsByClassName("playicon").length > 0)
            document.getElementsByClassName("playicon")[0].style.display = "none";
        var e = document.getElementById("over-video-layer");
        if (e) {
            e.style.display = "none";
            if (typeof e.onclick == "undefined" || e.onclick == null) {
                e.onclick = function(t) {
                    var n = t.srcElement || t.originalTarget || t.target;
                    if (n.className != "playicon")
                        Ads.videoClick(e);
                    return 0
                }
            } else {
                Video.playAd()
            }
        }
        return 0
    },
    showThumbnail: function() {
        if (document.getElementsByClassName("playicon").length > 0)
            document.getElementsByClassName("playicon")[0].style.display = "block";
        var e = document.getElementById("over-video-layer");
        if (e) {
            e.style.display = "block"
        }
        return 0
    },
    videoClick: function(e) {
        if (clickLinkList[Ads.toksCounter] != "") {
            window.open(clickLinkList[Ads.toksCounter], "_blank")
        }
    },
    discussionClick: function(e) {
        return Ads.fireClick(e, "_discussion")
    },
    timeLeftUpdate: function() {
        timeLeftEl = document.getElementsByClassName("time-left")[0];
        timeLeftVal = parseInt(timeLeftEl.attributes["value"].value);
        if (timeLeftVal <= 1) {
            leftTokEl = document.getElementsByClassName("cenLeft")[0];
            leftTokId = leftTokEl.attributes["data-id"].value;
            Ads.loadTok(leftTokId)
        }
        timeLeftEl.attributes["value"].value=--timeLeftVal;
        timeLeftEl.innerHTML = "0:0" + timeLeftVal;
        return 1
    },
    fireClick: function(e, t) {
        if (typeof window.clkUrl !== "undefined" && window.clkUrl !== null) {
            ajaxFunction(window.clkUrl)
        }
        Ads.user_activities("CLICK", window.adId + t, window.adUUId);
        return Video.playAd()
    },
    reloadMoreToks: function() {
        if (typeof window.moreToks !== "undefined" && window.moreToks) {
            ajaxFunction(serverName + "/ads/" + window.adId + "/toks?tokId=" + window.tokId, "GET", function(e) {
                Video.overLayer(false);
                document.getElementById("ac_results").style.display = "none";
                toks_container = document.createElement("div");
                toks_container.id = "toks_container";
                toks_container.innerHTML = e;
                document.getElementById(window.videoContainer).appendChild(toks_container);
                Ads.timeLeftInterval = setInterval(function() {
                    return Ads.timeLeftUpdate()
                }, 1e3)
            })
        }
    },
    loadTok: function(e) {
        if (Ads.timeLeftInterval!=-1)
            clearInterval(Ads.timeLeftInterval);
        ajaxFunction(serverName + "/ads/" + window.adId + "/tok/" + e, "GET", function(t) {
            Ads.votedBtn = null;
            window.tokId = e;
            document.getElementById("discussion_item").innerHTML = t;
            Ads.voteBtnText();
            if (typeof window.moreToksPanel !== "undefined" && window.moreToksPanel) {
                toksContainerEl = document.getElementById("toks_container");
                toksContainerEl.parentElement.removeChild(toksContainerEl);
                document.getElementById("ac_results").style.display = "block"
            }
        })
    },
    loadNextTok: function() {
        if (typeof window.moreToks !== "undefined" && window.moreToks) {
            Ads.toksCounter++;
            if (Ads.toksCounter >= window.toksList.length)
                Ads.toksCounter = 0;
            Ads.loadTok(window.toksList[Ads.toksCounter])
        }
    },
    logger: function(e) {
        if ("dev" === window.env)
            console.log("TOK :: " + e)
    },
    voteBtnText: function() {
        var e = document.getElementsByClassName("choice");
        if (e.length > 0) {
            var t = document.getElementsByClassName("vote-option")[0];
            var n = 0;
            var r = originalFontSize = 14;
            for (var i = 0; i < e.length; i++) {
                t.innerHTML = e[i].innerHTML;
                n = t.offsetWidth > n ? t.offsetWidth : n;
                r = Math.floor((e[i].offsetWidth - 6) / n * originalFontSize);
                r = Math.min(r, 14)
            }
            for (i = 0; i < e.length; i++) {
                e[i].style.fontSize = r + "px"
            }
        }
    },
    user_activities: function(e, t, n) {
        if (typeof n !== "undefined")
            ajaxFunction(serverName + "/users/activities?activity=ADS&content=" + e + "&msg=" + t + "&objectId=" + n)
    }
};
var didInit = false;
var init = function() {
    if (!didInit) {
        didInit = true;
        if (typeof window.adId !== "undefined" && typeof window.adUUId !== "undefined") {
            Ads.voteBtnText()
        }
        if (document.getElementsByTagName("body")[0].id === "ads-show" || document.getElementById("ads-show")) {
            return Video.playAd()
        }
    }
};
if (window.attachEvent) {
    window.attachEvent("onload", init)
} else {
    window.addEventListener("load", init)
}

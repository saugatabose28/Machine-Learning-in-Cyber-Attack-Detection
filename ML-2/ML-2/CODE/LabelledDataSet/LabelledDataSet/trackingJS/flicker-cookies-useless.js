(function(){if(typeof window.F==='undefined'){window.F={};} if(typeof window.F.adHelper!=='undefined'){return false;} var postMessageQueue=[],adUnits={},onEmptyQueue=[],onScheduledQueue=[],defaultAdID='none',spaceIDPrefix='SPACEID_',adIDPrefix='_ADID_',positionPrefix='_POSITION_';function normalizeAdID(adID){if(adID===undefined||!adID){adID=defaultAdID;} return adID;} function getAdUnit(spaceID,position,adID){adID=normalizeAdID(adID);var guid=spaceIDPrefix+spaceID+positionPrefix+position+adIDPrefix+adID;if(typeof adUnits[guid]==='undefined'){adUnits[guid]={has_ad:false,complete:false};} return adUnits[guid];} function setAdUnit(spaceID,position,adID,property,value){adID=normalizeAdID(adID);var adUnit=getAdUnit(spaceID,position,adID);adUnit[property]=value;adUnit.complete=true;} function queueAdEvent(queue,processQueueMethod,params,callback){var spaceID,position,adID,adUnit;spaceID=params.spaceID||null;position=params.position||null;adID=normalizeAdID(params.adID);if(!spaceID||!position||!callback){return false;} adUnit=getAdUnit(spaceID,position,adID);queue.push({spaceID:spaceID,position:position,adID:adID,callback:callback,callbackFired:false});processQueueMethod(spaceID,position);} function onScheduledAd(params,callback){queueAdEvent(onScheduledQueue,processOnScheduledQueue,params,callback);} function onEmptyAd(params,callback){queueAdEvent(onEmptyQueue,processOnEmptyQueue,params,callback);} function processQueue(queue,spaceID,position,adID,hasAdExpectation){var i,j,adUnit;for(i=0,j=queue.length;i<j;i++){adUnit=getAdUnit(queue[i].spaceID,queue[i].position,queue[i].adID);if(adUnit.complete&&adUnit.has_ad===hasAdExpectation){if(queue[i].callback&&!queue[i].callbackFired){queue[i].callbackFired=true;queue[i].callback();}}}} function processOnEmptyQueue(spaceID,position,adID){processQueue(onEmptyQueue,spaceID,position,adID,false);} function processOnScheduledQueue(spaceID,position,adID){processQueue(onScheduledQueue,spaceID,position,adID,true);} function queuePostMessage(evt){postMessageQueue.push(evt);processMessageQueue();} function processMessageQueue(){var i,j;for(i=0,j=postMessageQueue.length;i<j;i++){processMessage(postMessageQueue[i]);} postMessageQueue=[];} function processMessage(evt){var i,j;var adBox;var iframes;var offset;var eventParamsArray;var eventParams={};var item;var spaceID;var position;var adID;var url;if(!evt||!evt.origin){return;} if(!evt.origin.match(/y-flickr\.yahoo\.com$/)&&!evt.origin.match(/\.flickr\.yahoo\.com$/)&&!evt.origin.match(/\.flickr\.com$/)){return;} if(evt.data){if(typeof evt.data==='string'){eventParamsArray=evt.data.split('&');for(i=0,j=eventParamsArray.length;i<j;i++){item=eventParamsArray[i].split('=');eventParams[item[0]]=decodeURIComponent(item[1]);}}else{eventParams=evt.data;}} if(eventParams&&eventParams.spaceid&&eventParams.position){spaceID=eventParams.spaceid;position=eventParams.position;adID=eventParams.adid;if(eventParams.has_ad){setAdUnit(spaceID,position,adID,'has_ad',true);processOnScheduledQueue(spaceID,position,adID);}else if(eventParams.no_ad){setAdUnit(spaceID,position,adID,'has_ad',false);processOnEmptyQueue(spaceID,position,adID);}}} function setCookie(name,value,date){var expires='';expires='; expires='+date.toUTCString();domain='.flickr.com';var str=name+'='+escape(value)+expires+'; path=/; domain='+domain;document.cookie=str;} function deleteCookie(name){setCookie(name,0,new Date(0));} function disableAd(cookieName){var date=new Date();var midnight=new Date(date.getFullYear(),date.getMonth(),date.getDate(),23,59,59);setCookie(cookieName,1,midnight);} function restoreAd(cookieName){deleteCookie(cookieName);} window.F.adHelper={onEmptyAd:onEmptyAd,onScheduledAd:onScheduledAd,disableAd:disableAd,restoreAd:restoreAd};var prefix=(navigator.userAgent.match(/msie 8/i)?'on':'');var addListener=window.addEventListener||window.attachEvent||null;if(addListener){addListener(prefix+'message',queuePostMessage,false);addListener(prefix+'message',function(evt){window.setTimeout(processMessageQueue,1);},false);processMessageQueue();}}());
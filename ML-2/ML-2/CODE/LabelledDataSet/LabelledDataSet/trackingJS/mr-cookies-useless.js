
if (!window.__PHS){
	var __PHS = {};
}
(function(s){
	
	s.authFormExtDomainsEnabled = true;
	s.portalAuthEnabled = true;
	s.disableGamesCounter = false;
	s.staticDir = '//img.imgsmail.ru/p/h/d/0.34.9/';
	s.loginLink = 'https://r.mail.ru/cls951827/e.mail.ru/login?lang=ru_RU&page=';
	s.loginLinkXName = 'clb1126064';
	s.externalJS = '//img.imgsmail.ru/p/h/d/0.34.9/external.min.js';
	s.externalNewJS = '//img.imgsmail.ru/p/h/d/0.34.9/external.new.min.js';
	s.pv = '2';
	s.eid = '';
	s.siteid = '169';
	s.registerBackUrl = false;
	s.bizLinks = false;
	s.newOK = true;
	s.loveCounter = true;
	s.mailEvents = false;
	s.disableIFCheck = false;
	s.mailSplashUpdate = true;
	s.newDesign = false;
	s.exitInside = false;
	s.newExit = true;
	s.region = 'Канберра';
	s.regionEnabled = false;
	s.settingsText = s.settingsText || false;

	if (!s.lang){
		s.lang = "ru_RU";
	}
})(window['__PHS']);
(function(){function I(a){for(var a=a||{},d=1,b=arguments.length;d<b;d++){var e=arguments[d],c;for(c in e)e.hasOwnProperty(c)&&(a[c]=e[c])}return a}function Y(a,d){for(var b in d)Object.prototype.hasOwnProperty.call(d,b)&&!Object.prototype.hasOwnProperty.call(a,b)&&(a[b]=d[b]);return a}function J(a){return document.getElementById(a)}function Z(a,d,b){var e=[],c=0;if("string"===typeof a)e.push([a,d]),c+=d;else{for(var i in a)a.hasOwnProperty(i)&&(e.push([i,a[i]]),c+=a[i]);b=d}a=0;for(d=e.length;a<
d;a++)e[a]=e[a].join(":");(new Image).src="//headline.radar.imgsmail.ru/update?p=headline&t="+(b||K)+"&v="+c+"&i="+e.join(",")+"&rnd="+Math.random()+(document.referrer?"&r="+escape(document.referrer):"")}function $(a,d){return a.bind.apply(a,D.call(arguments,1))}function aa(a,d,b){function e(){a();i||(c=E(e,d))}var c,i;b&&a();c=E(e,d);return function(){i=!0;L(c)}}function ba(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault?a.preventDefault():a.returnValue=!1}function ca(a){a.preventDefault?
a.preventDefault():a.returnValue=!1}function M(a,d,b,c){if(d)if(d.addEventListener)d[a?"addEventListener":"removeEventListener"](b,c,!1);else d[a?"attachEvent":"detachEvent"]("on"+b,c)}function t(a){return a&&1==a.nodeType}function N(a){(function(){for(var a,b=arguments,e=b.length;e--;){a=b[e].split(",");for(var g=a.length;g--;){var i=a[g],l=void 0,k=parseInt(1E9*Math.random()),j=void 0;if(l=i.match(/^(?:cl([bn])|([adgin]))(\d+)(?:sz(\d+))?/))l[1]?j="s"+l[1]:"n"==l[2]?j="nc":("i"==l[2]&&(k=null),
j=l[2]),j+=l[3]+".gif?",l[4]&&(j+="sz="+l[4]),k&&(j+="&rnd="+k),c.settings.eid&&(j+="&test_id="+c.settings.eid),(new Image).src="//rs.mail.ru/"+j}}})(a)}function da(a){M(1,a,"mousedown",function(a){a||(a=window.event);for(a=a.target||a.srcElement;a;)a.getAttribute&&a.getAttribute("xname")&&N(a.getAttribute("xname")),a=a.parentNode})}function ea(a,d){var b;b=t(d)?function(a,b){return a==b}:function(a,b){return w(a,b)};for(var c=a.parentNode;c;){if(b(c,d))return c;c=c.parentNode}return!1}function fa(a){for(;a.firstChild;)a.removeChild(a.firstChild)}
function w(a,b){return t(a)&&x?a.classList.contains(b):!!~(" "+a.className+" ").indexOf(" "+b+" ")}function y(a,b){t(a)&&(x?a.classList.add(b):!w(a,b)&&(a.className+=" "+b))}function O(a,b){t(a)&&(x?a.classList.remove(b):a.className=a.className.replace(RegExp("(^|\\s)"+b+"(\\s|$)","g"),"$1"))}function ga(a,b){if(t(a))return x?a.classList.toggle(b):w(a,b)?(O(a,b),!1):(y(a,b),!0)}function ha(a){return"string"!==typeof a||!a?null:(new Function("return "+a))()}function ia(){return!!b.SCookie.getGlobal(P)}
function z(a,b,f){if(void 0!==b){var c,f=f||{};null===b&&(b="",f.expires=-1);b+="";document.cookie=a+"="+b+(f.expires&&(c="number"==typeof f.expires&&(c=new Date),c.setTime(c.getTime()+864E5*f.expires),c||"toUTCString"in f.expires&&f.expires)&&"; expires="+c.toUTCString()||"")+(f.path?"; path="+f.path:"")+(f.domain?"; domain="+f.domain:"")+(f.secure?"; secure":"");return b}if(""!==(document.cookie||""))return b=(document.cookie.match(RegExp("(?:^| )"+a+"\\=(\\S*)(?:; |$)"))||[])[1],void 0===b?void 0:
b}function Q(){this._invocations=[];this._context=this._fn=null}function s(){}function F(a){this._node=b.byId(a);this._container=this._node.parentNode}function ja(a){this._counters=a;for(var b in this._counters)this._counters.hasOwnProperty(b)&&(this._counters[b]=new F(this._counters[b]));this.update=function(a,b){if("string"==typeof a){var d={};d[a]=b;this.update(d)}else for(d in a)a.hasOwnProperty(d)&&(this._counters[d].update(a[d]),this._counters[d]._enableAnims=c.activeUser())}}function m(a){m.__all.push(this);
this._opts=a;this._open=b.bind(this._open,this);this._baseClass=a.baseClass;this._rootNode=a.rootNode;this._dropdown=a.dropdown;this._button=a.button;this._openCounter=a.openCounter||null;this._hideTimeout=null;this._orientation=this._opts.orientation;this._openClass=this._baseClass+"_open";this._rightClass=this._openClass+"_right";this._leftClass=this._openClass+"_left";this._inited=!!this._dropdown;this._triggerHideOnInit=this._triggerShowOnInit=!1;b.event(1,this._button,"click",b.bind(this.show,
this))}function n(a,b){b=b||{};this._url=a;this._encoding=b.encoding;this._JSONPCallbackParam=b.JSONPCallbackParam||"callback";this._xhrEnabled=b.xhrEnabled||!1;this._processing=!1;this._requestSource=b.requestSource;this._xhr2Supported=!1;try{XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&(this._xhr2Supported=!0)}catch(c){}}function ka(a){function d(){g!==(g=location.hash.replace(/^#/,"")||null)&&c()}this._userEmail=a.userEmail;this.____user=this._userEmail.innerHTML||void 0;this._user=
null;this._updateByTimeout=a.updateByTimeout;this.updateLastRequest=0;this._noAuthView=a.noAuthView;this._authView=a.authView;this.updateAccountInfo();var c=b.bind(this.updateAccountInfo,this),e=!1;if(!this._updateByTimeout)if(window.jsHistory&&window.jsHistory.change)window.jsHistory.change(function(){e&&c();e=!0});else if("onhashchange"in window)b.event(1,window,"hashchange",c);else{var g=location.hash.replace(/^#/,"")||null;b.setIntervalByTimeout(d,50)}}var u=window.console||{};u.log=u.log||function(){};
u.time=u.time||function(){};u.timeEnd=u.timeEnd||function(){};u.time("headline.inline.js");if(!window.__PH){var c=window.__PH={},b={};c.settings=window.__PHS;c.settings.swaDomain="//portal.mail.ru";c.settings.authDomain="https://auth.mail.ru";/^https?:\/\/[^/]*?\.dev\.?mail\.ru($|\/\S*)/i.test(location.href)&&(/^https?:\/\/[^/]*?\.devmail\.ru($|\/\S*)/i.test(location.href)?(c.settings.swaDomain="//portal.devmail.ru",c.settings.authDomain="https://auth.devmail.ru"):(c.settings.swaDomain="//portal.dev.mail.ru",
c.settings.authDomain="https://auth.dev.mail.ru"));c.settings.swaTest&&(c.settings.swaDomain="//portal.test.mail.ru",c.settings.authDomain="https://test.auth.mail.ru");c._=b;if(!c.settings.disableIFCheck)try{top.location.toString()}catch(ra){top.location=location}var K="home",E=window.setTimeout,L=window.clearTimeout,q=J("portal-headline"),G=!1,r=navigator.userAgent,p=[];-1!=r.indexOf("Firefox")?p.push("x-ph-ff"):-1!=r.indexOf("Opera")&&p.push("x-ph-opera");if(-1!=r.indexOf("iPad")||-1!=
r.indexOf("iPhone")||-1!=r.indexOf("iPod"))p.push("x-ph-ios"),G=!0;-1!=r.indexOf("Mac OS")&&!G?p.push("x-ph-mac"):-1!=r.indexOf("Windows")?p.push("x-ph-win"):p.push("x-ph-not-desk");"ontouchstart"in window?p.push("x-ph-touch"):p.push("x-ph-no-touch");q.className+=" "+p.join(" ");var D=Array.prototype.slice;void 0===Function.prototype.bind&&(Function.prototype.bind=function(a){var b=D.call(arguments,1),c=this;return function(){return c.apply(a,b.concat(D.call(arguments,0)))}});var x="classList"in document.documentElement,
r=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b)}:function(a,b){for(var c=0,e=a.length;c<e;c++)if(a[c]==b)return c;return-1},p=window.devicePixelRatio,la=void 0!=document.createElement("div").style.backgroundSize&&1<p,P="s_c",H,R=document.createElement("div"),S=["Khtml","Ms","O","Moz","Webkit"],T=S.length;H=function(a){if(a in R.style)return!0;for(a=a.replace(/^[a-z]/,function(a){return a.toUpperCase()});T--;)if(S[T]+a in R.style)return!0;return!1};H("textShadow")?
y(q,"x-ph-box-shadow"):y(q,"x-ph-no-box-shadow");var A=1*new Date+"",ma=A.substring(A.length-2),A=b,na=K,oa=/\s*(\S+)\s*/g,pa=!/\[native\s+code\]/i.test(document.getElementsByClass+""),qa=/\./g;I(A,{percent:function(a){return ma<a},supports:H,extend:I,append:Y,dpr:p,retina:la,project:na,setTimeout:function(a,b){return E(a,b)},clearTimeout:function(a){return L(a)},rootNode:q,byId:J,byClassName:function(a,b,c){var e,g;"string"===typeof a&&(c=b,b=a,a=document);c=c||"";if(!a||null==b)return[];b=b.replace(/\s+/ig,
".");"."!=b[0]&&(b="."+b);if("querySelectorAll"in a){c=a.querySelectorAll(c+b);if(pa){e=-1;for(a=[];g=c[++e];)a.push(g);return a}return c}c=a.getElementsByTagName(c||"*");b&&(b=b.replace(qa," "),b=RegExp(b.replace(oa,"(?=(^|.*\\s)$1(\\s|$))")));e=-1;for(a=[];g=c[++e];)1===g.nodeType&&(!b||b.test(g.className))&&a.push(g);return a},radar:Z,bind:$,setIntervalByTimeout:aa,eventCancel:ba,eventPreventDefault:ca,event:M,isNode:t,emptyNode:fa,count:N,countEl:da,hasParent:ea,hasClass:w,removeClass:O,addClass:y,
toggleClass:ga,ArrayIndexOf:r,parseJson:ha,isCorp:ia,isCorpCookie:P,iOs:G});var h={_S_cookie_set_get_remove:function(a,b,c,e){var g,i=RegExp("(^|\\|)("+c+"=)(.*?)(\\||$)"),l={domain:b,expires:365,path:"/"};if(c){b=z(a)||"";g=(b.match(i)||[])[3];var k=null;void 0!==e?(z(a,void 0!==g||null===e?k=b.replace(i,null===e?function(a,b,d,c,f,e,g){return 0===g.indexOf(a)?"":f}:"$1$2"+e+"$4"):(b?b+"|":"")+c+"="+e,l),""===k&&z(a,null,l)):e=g;return e}},_throw_noValue_Error:function(){throw Error("need value");
},__prefix:null,__domain:null,setProject:function(a,b){if(!a||!b)throw Error("project is not valid");"."!==b.substr(0,1)&&(b="."+b);h.__prefix=a;h.__domain=b},_getPrefix:function(a){a||(a={});a.prefix=a.prefix||h.__prefix;a.domain=a.domain||h.__domain;if(!a.prefix||!a.domain)throw Error("run setProject before");return a},getGlobal:function(a){return h._S_cookie_set_get_remove("s",".mail.ru",a)},setGlobal:function(a,b){void 0===b&&h._throw_noValue_Error();h._S_cookie_set_get_remove("s",".mail.ru",
a,b);return h.getGlobal(a)},removeGlobal:function(a){var b=h.getGlobal(a);h._S_cookie_set_get_remove("s",".mail.ru",a,null);return b},getLocal:function(a,b){b=h._getPrefix(b);return h._S_cookie_set_get_remove("s_"+b.prefix,b.domain,a)},setLocal:function(a,b,c){c=h._getPrefix(c);void 0===b&&h._throw_noValue_Error();h._S_cookie_set_get_remove("s_"+c.prefix,c.domain,a,b);return h.getLocal(a,c)},removeLocal:function(a,b){var b=h._getPrefix(b),c=h.getLocal(a,b);h._S_cookie_set_get_remove("s_"+b.prefix,
b.domain,a,null);return c}};b.SCookie=h;Q.prototype={getQuery:function(){var a=b.bind(this.invoke,this);a.replace=b.bind(this.replace,this);return a},invoke:function(){this._fn?this._fn.apply(this._context,arguments):this._invocations.push(arguments)},replace:function(a,b){if(!this._fn){for(var b=b||window,c=0,e=this._invocations.length;c<e;c++)a.apply(b,this._invocations[c]);delete this._invocations;this._fn=a;this._context=b}}};b.extend(b,{DeferredQuery:Q});s.prototype={emit:function(a,b,c){function e(){--i||
c&&c()}void 0==b&&(b={});var g=this.listeners(a);if(g)for(var g=g.slice(),a=new s.Event(a,b),i=g.length,b=0,l=i;b<l;b++){var k=g[b];if("function"===typeof k)try{k.call(this,a,e)}catch(j){e()}}else c&&c()},listeners:function(a){return this._events&&this._events[a]&&this._events[a].length&&this._events[a]},addListener:function(a,b){if("function"!==typeof b)throw Error("invalid argument");this._events||(this._events={});this._events[a]||(this._events[a]=[]);this._events[a].push(b);this.emit("newlistener",
{type:a});return this},once:function(a,b){function c(){this.removeListener(a,c);b.apply(this,arguments)}if("function"!==typeof b)throw Error("invalid argument");this.on(a,c);return this},removeListener:function(a,c){if("function"!==typeof c)throw Error("invalid argument");if(!this._events[a])return this;var f=this._events[a],e=b.ArrayIndexOf(f,c);if(0>e)return this;f.splice(e,1);0===f.length&&delete this._events[a];return this}};s.prototype.on=s.prototype.addListener;s.Event=function(a,b){this.type=
a;this.data=b};s.relay=function(a,b,c){for(var e=0,g=a.length;e<g;e++){var i=a[e];b.on(i,function(a){return function(){c.emit(a)}}(i))}};b.EventEmitter=s;(function(){function a(){var a=d();a.id++;id=a.id;4095<id&&(id=0);f(id);a=d();return a.id}function d(){var a=h.getGlobal(r),b;if(!a)return f(0,0,{id:0,current:0}),{id:0,current:0};b=parseInt(a.substr(0,3),16);a=parseInt(a.substr(3,6),16);return{id:b,current:a}}function f(a,b,c){(c=c||d())||(c={});void 0!==a&&(c.id=a);c.id=void 0!=c.id&&c.id.toString(16);
switch(c.id.length){case 1:c.id="00"+c.id;break;case 2:c.id="0"+c.id}void 0!==b&&(c.current=b);c.current=void 0!=c.current&&c.current.toString(16);switch(c.current.length){case 1:c.current="00"+c.current;break;case 2:c.current="0"+c.current}h.setGlobal(r,c.id+c.current)}function e(a,e){function j(a){l!==a&&(l=a,c.emit("visibilitychange",{hidden:a,visible:!a}))}var h;if(e)h=e.hidden,j(h);else if(h="focus"==a.type||"focusin"==a.type?!1:"blur"==a.type||"focusout"==a.type?!0:!!document[g],"focusout"==
a.type)i=b.setTimeout(function(){i=void 0;j(h)},0);else if("focusin"==a.type)void 0!==i?b.clearTimeout(i):j(h),i=void 0;else if((p||q)&&!k)if(h)i=b.setTimeout(function(){i=void 0;try{d().current===n||j(h)}catch(a){b.radar("cookieError",1)}},200);else{try{d().current!==n&&(f(void 0,n),j(h))}catch(m){b.radar("cookieError",1)}b.clearTimeout(i);i=void 0}else j(h)}var g,i,l=!1,k,j={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange",
oHidden:"ovisibilitychange"};for(g in j)if(j.hasOwnProperty(g)&&g in document){k=j[g];break}var j=navigator.userAgent,m=-1<j.indexOf("iPad")||-1<j.indexOf("iPhone")||-1<j.indexOf("iPod"),p=!k&&-1<j.indexOf("Opera"),q=0<j.indexOf("Safari")&&-1===j.indexOf("Chrome"),r="t";try{if((p||m||q)&&!k){var n=a();f(void 0,n)}}catch(u){b.radar("cookieError",1)}if(k)b.event(1,document,k,e);else if(window.eval&&eval("/*@cc_on!@*/false"))b.event(1,document,"focusin",e),b.event(1,document,"focusout",e);else if(m){var s=
new Date,t=function(){b.clearTimeout(50);b.setTimeout(t,50);var a=new Date;100<a.getTime()-s.getTime()&&d().current!==n&&(f(void 0,n),l=!1,e({},{hidden:!0}),l=!0,e({},{hidden:!1}));s=a};b.setTimeout(t,50)}else b.event(1,window,"focus",e),b.event(1,window,"blur",e)})();F.prototype={visibleClass:"x-ph__link_ext",show:function(){b.addClass(this._container,this.visibleClass);b.clearTimeout(this._animTimeout);b.clearTimeout(this._animResetTimeout);this._anim&&this._enableAnims&&(this._animTimeout=b.setTimeout(function(){b.addClass(this._node,
"x-ph-animated_flash");this._animResetTimeout=b.setTimeout(function(){b.removeClass(this._node,"x-ph-animated_flash")}.bind(this),1E3)}.bind(this),100))},hide:function(){b.removeClass(this._container,this.visibleClass)},value:function(a){void 0!==a&&(this._node.innerHTML=this.prepare(a));return parseInt(this._node.innerHTML,10)||0},prepare:function(a){a=parseInt(a);return 0<a?a:0},update:function(a){var b=this.value(),a=this.value(a);if(a>b||c.activeUser()!=this._enableAnims)this._anim=!0;this[a?
"show":"hide"]();this._anim=!1}};b.Couners=ja;b.Couner=F;m.__all=[];m.resetShowOnInit=function(a){for(var b=0,c=m.__all.length;b<c;b++){var e=m.__all[b];if(!a||e!==a)e._triggerShowOnInit=!1,e._triggerHideOnInit=!1}};m.hideAll=function(){for(var a=0,b=m.__all.length;a<b;a++){var c=m.__all[a];c._triggerShowOnInit=!1;c._triggerHideOnInit=!1;c.hide()}};b.extend(m.prototype,b.EventEmitter.prototype,{init:function(a){!this._dropdown&&a&&(this._dropdown=a,this._rootNode.appendChild(a),this._inited=!0,this._triggerShowOnInit&&
this.show(),this._triggerHideOnInit&&this.hide(),this._triggerHideOnInit=this._triggerShowOnInit=!1)},_mouseIn:function(){b.clearTimeout(this._hideTimeout)},_mouseOut:function(){b.clearTimeout(this._hideTimeout);this._hideTimeout=b.setTimeout(b.bind(this.hide,this),4E3)},isVisible:function(){return b.hasClass(this._rootNode,this._openClass)},show:function(a){b.clearTimeout(this._hideTimeout);a&&b.eventPreventDefault(a);this._inited?this.isVisible()||this.emit("show",{},b.bind(function(){this.__toggle(!0)},
this)):(this._triggerShowOnInit=!0,m.resetShowOnInit(this))},hide:function(){this._inited?this.isVisible()&&this.emit("hide",{},b.bind(function(){this.__toggle(!1)},this)):this._triggerShowOnInit?this._triggerShowOnInit=!1:this._triggerHideOnInit=!0},_hideOther:function(){for(var a=0,b=m.__all.length;a<b;a++){var c=m.__all[a];c!=this&&c.isVisible()&&c.hide();c._triggerShowOnInit=!1}},_click:function(a){var c=a.target||a.srcElement;c==this._dropdown||b.hasParent(c,this._dropdown)?this.emit("click",
{clickEvent:a},b.bind(this.hide,this)):"click"==a.type&&(b.hasParent(c,this._rootNode)&&b.eventPreventDefault(a),this.hide())},_open:function(){b.clearTimeout(this._openTimeout);this._openTimeout=b.setTimeout(b.bind(function(){if(this._orientation)b.addClass(this._rootNode,this._openClass),b.addClass(this._rootNode,this["_"+this._orientation+"Class"]);else{var a=this._dropdown.clientWidth,d=this._rootNode.offsetLeft,f=a+(this._rootNode.offsetParent==b.rootNode?d:1E4),e=document.body.offsetWidth;b.addClass(this._rootNode,
this._openClass);b.removeClass(this._rootNode,f<=e?this._rightClass:this._leftClass);b.addClass(this._rootNode,f>e?this._rightClass:this._leftClass);c.settings.newDesign&&(this._dropdown.style.right=d+this._rootNode.clientWidth<a&&f>e?-(a-(d+this._rootNode.clientWidth)+10)+"px":"")}a=b.bind(function(){window.webkitURL&&(this._dropdown.style.width=this._dropdown.clientWidth+1+"px",this._dropdown.style.width=null)},this);a();b.setTimeout(a,0)},this),0)},__toggle:function(a){b.clearTimeout(this.__eventsTimeout);
this.__eventsTimeout=b.setTimeout(b.bind(function(){b.event(a,document,"click",this.__click||(this.__click=b.bind(this._click,this)));b.event(a,this._rootNode,"mouseout",this.__mouseOut||(this.__mouseOut=b.bind(this._mouseOut,this)));b.event(a,this._rootNode,"mouseover",this.__mouseIn||(this.__mouseIn=b.bind(this._mouseIn,this)))},this),10);a?(this._openCounter&&b.count(this._openCounter),"block"!==this._dropdown.style.display&&(this._dropdown.style.display="block"),this._open(),b.event(1,window,
"resize",this._open)):(b.removeClass(this._rootNode,this._openClass),b.removeClass(this._rootNode,this._leftClass),b.removeClass(this._rootNode,this._rightClass),b.event(0,window,"resize",this._open))}});b.Menu=m;var U=document.getElementsByTagName("head")[0];n.prototype={get:function(a){a=b.extend({encoding:this._encoding,params:{},complete:function(){}},a);this.cancel();return this[this._isXHR2()?"_getXHR":"_getScript"](this._url,a)},_isXHR2:function(){return this._xhrEnabled&&this._xhr2Supported},
_getUrl:function(a,b){var c=!!~a.indexOf("?");b.rnd=(new Date).getTime();for(var e in b)if(b.hasOwnProperty(e)){var g=b[e];"function"==typeof g&&(g=g(b));void 0!==g&&(a+=(c?"&":"?")+e+"="+encodeURIComponent(g),c=!0)}return a},_getXHR:function(a,c){var f=new XMLHttpRequest;f.onreadystatechange=b.bind(function(){if(this._processing){var a;if(4===f.readyState){b.clearTimeout(this._xhrTimeout);this._processing=!1;if(200==f.status){var g;try{g=b.parseJson(f.responseText)}catch(i){a=i}}!a&&200==f.status?
(a=g,a.error&&!a.errorType&&(a.errorType="serverError")):a=a?{status:"error",errorType:"parseError"}:200!=f.status?{status:"error",errorType:"netError"}:{status:"error"};this._requestSource&&(a.requestSource=this._requestSource);c.complete(a)}}},this);this._processing=!0;b.clearTimeout(this._xhrTimeout);c.timeout&&(this._xhrTimeout=b.setTimeout(b.bind(function(){this._processing&&(b.clearTimeout(this._xhrTimeout),this._processing=!1,this.cancel(),c.complete({status:"error",errorType:"timeout"}))},
this),c.timeout));f.open("get",this._getUrl(a,c.params),!0);f.withCredentials=!0;f.send(null);this._xhr=f},_getScript:function(a,c){function f(){U.appendChild(g);b.setTimeout(function(){U.removeChild(g)},6E4)}var e=this._cbName="__PHJSONPCallback_"+n.getUuid(),g=document.createElement("script"),i,h=c.timeout;c.params[this._JSONPCallbackParam]=e;a=this._getUrl(a,c.params);window[e]=b.bind(function(a){b.clearTimeout(i);window[e]=n.__PHEmptyCallback;this._cbName=null;this._processing=!1;this._requestSource&&
(a.requestSource=this._requestSource);a.error&&!a.errorType&&(a.errorType="serverError");"cancel"!=a.status&&c.complete(a)},this);g.defer="defer";g.async="async";g.type="text/javascript";c.encoding&&(g.charset=c.encoding);g.src=a;!("opera"in window)||"complete"===document.readyState?(this._processing=!0,f()):window.addEventListener("DOMContentLoaded",b.bind(function(){this._processing=!0;f()},this),!1);h&&(i=b.setTimeout(b.bind(function(){window[this._cbName]({status:"error",errorType:"timeout"})},
this),h))},isProcessing:function(){return this._processing},cancel:function(){this._isXHR2()?this._cancelXHR():this._cancelScript()},_cancelXHR:function(){this._xhr&&this._xhr.abort()},_cancelScript:function(){this._cbName&&window[this._cbName]&&window[this._cbName]({status:"cancel"})}};n.__uuid=0;n.getUuid=function(){return n.__uuid++};n.__PHEmptyCallback=function(){};b.extend(b,{Transport:n});b.AccountManager=ka;b.extend(b.AccountManager.prototype,b.EventEmitter.prototype,{activeUser:function(){return this._user},
updateLogin:function(a){this._user=a;(this._userEmail.innerHTML=a)?(this._noAuthView.style.display="none",this._authView.style.display=""):(this._authView.style.display="none",this._noAuthView.style.display="")},isCorp:b.isCorp,isCorpCookie:b.isCorpCookie,setCorp:function(a){for(var c=0,f=a.length;c<f;c++)if("corp.mail.ru"===a[c].split("@")[1])return b.SCookie.setGlobal(this.isCorpCookie,(new Date).getTime()),!0;if((a=b.SCookie.getGlobal(this.isCorpCookie))&&(new Date).getTime()>1*a+864E5)return b.SCookie.removeGlobal(this.isCorpCookie),
!1}});var V=!1,B=b.byId("ph_mail"),C=b.byId("ph_my");b.extend(b.AccountManager.prototype,{updateLinks:function(a){B.href=B.href.split("?")[0];var d=[];c.settings.siteid&&!a.email&&d.push("siteid="+c.settings.siteid);"mail"===b.project&&d.push("lang="+c.settings.lang);a.email||d.push("_1ld=1_1000043_1000475_0");d.length&&(B.href=B.href+"?"+d.join("&"));C.href=C.href.split("?")[0];d=[];a.email||d.push("_1ld=1_1000006_1000476_0");d.length&&(C.href=C.href+"?"+d.join("&"))},updateCounters:function(a){var d=
{},a=a||{};if("mail"!=b.project&&!("home"==b.project&&c.settings.mailSplashUpdate)||!V&&"mail"==b.project&&!c.settings.mailEvents)d.mail=a.mail_cnt||0;V=!0;d.my=a.my_cnt||0;c.settings.disableGamesCounter||(d.games=a.games_cnt||0);this.updateNotifier(a);b.counters.update(d)},updateNotifier:function(a){var c=b.byId("PH_authMenu"),a=a.mail_notifier?parseInt(a.mail_notifier,10):0;b[(0==a?"remove":"add")+"Class"](c,"x-ph__menu_auth_unread")},_sendError:function(a){var c={updateError:1};a.errorType&&(c["updateError_"+
a.errorType]=1);a.requestSource&&(c["updateError_"+a.requestSource]=1,a.errorType&&(c["updateError_"+a.errorType+"_"+a.requestSource]=1));b.radar(c);this.emit("updateError")},_PHUpdater:function(a,d,f){function e(a){this.updateLinks(i);"ok"!=b.project&&c.settings.portalAuthEnabled&&this.updateLogin(k);this.updateCounters(i);"function"===typeof a&&a()}var d=d||function(){},g=a.status;if("error"==g)this._sendError(a),d();else{var i=a.data,h=i.action,k=i.email,j=b.bind(e,this);this.setCorp(i.list||[]);
c.settings.portalAuthEnabled?"switch"==h?"disabled"==g?f?(b.radar({disabledUser:1,disabledUserRestore:1}),d()):(this.emit("disabledUser"),c.emit("disabledUser",a.data,function(){b.radar({disabledUser:1,disabledUserSendToLogin:1});window.location="https://e.mail.ru/login?fail=1&d1&page="+encodeURIComponent(location.href)+"&email="+encodeURIComponent(k)})):"ok"==g&&k!=this.activeUser()?(this.emit("authChange"),c.listeners("authChange")?(b.radar("authChange",1),!k||void 0!==i.mail_cnt?c.emit("authChange",
a.data,function(){j(d)}):this.loadAccountInfo(b.bind(function(a){"error"==a.status?(this._sendError(a),d()):(i=b.extend(a.data,i),c.emit("authChange",i,function(){j(d)}))},this),k)):f?(b.radar("authChangeReloadDis",1),!k||void 0!==i.mail_cnt?j(d):this.loadAccountInfo(b.bind(function(a){"error"==a.status?(this._sendError(a),d()):(i=b.extend(a.data,i),j(d))},this),k)):(b.radar("authChangeReload",1),b.setTimeout(function(){location.reload()},10))):"noauth"==g&&k!=this.activeUser()?("home"===b.project&&
(g=[],g.push("headlineAuthLost"),g.push("mpop="+(c.cookie("Mpop")?"1":"0")),g.push("activeEmail="+this.activeUser()),g.push("newEmail="+k),(new Image).src="//gstat.imgsmail.ru/gstat?ua=1&logme="+encodeURIComponent(g.join(";"))+"&rnd="+(new Date).getTime()+Math.random()),b.radar("authLost",1),this.emit("authLost"),c.emit("authLost",a.data,b.bind(function(){a.status="ok";a.data.action="switch";this._PHUpdater(a,d,f)},this))):(b.radar("authRestore",1),"function"===typeof d&&d()):"list"==h&&("____user"in
this&&(this.____user!==k&&"mail"===b.project&&((new Image).src="//gstat.imgsmail.ru/gstat?logme="+encodeURIComponent("headlineFail;headlineEmail="+k+";projectEmail="+this.____user)+"&rnd="+(new Date).getTime()+Math.random(),h={userMismatch:1},h["userMismatch_"+(k?"":"no")+"HeadlineUser"]=1,h["userMismatch_"+(this.____user?"":"no")+"ProjectUser"]=1,h["userMismatch_"+(this.____user?"":"no")+"PUser_"+(k?"":"no")+"HUser"]=1,b.radar(h)),delete this.____user),null===this.activeUser()?(c.settings.enableUpdateRadars&&
b.radar("update",1),this.emit("update"),c.emit("update",a.data,function(){j(d)})):k==this.activeUser()?((h=c.cookie("Mpop"))&&("ok"==g&&this.activeUser()&&-1==h.indexOf(this.activeUser()))&&b.count("d1409289"),c.settings.enableUpdateRadars&&b.radar("update",1),this.emit("update"),c.emit("update",a.data,function(){j(d)})):(a.data.action="switch",this._PHUpdater(a,d,!0))):(c.settings.enableUpdateRadars&&b.radar("update",1),this.emit("update"),c.emit("update",a.data,function(){j(d)}))}}});b.extend(b.AccountManager.prototype,
{_authTransport:new b.Transport(c.settings.authDomain+"/cgi-bin/auth?mac=1",{JSONPCallbackParam:"JSONP_call",xhrEnabled:!0,requestSource:"auth"}),switchAccount:function(a,c,f){var e={};if(a){e.Login=a;var g=this.updateResume(c||function(){});this._authTransport.get({params:e,complete:b.bind(function(a){this._PHUpdater(a,g,f)},this),timeout:3E4})}},_logoutTransport:new b.Transport(c.settings.authDomain+"/cgi-bin/logout?mac=1",{JSONPCallbackParam:"JSONP_call",xhrEnabled:!0,requestSource:"logout"}),
logoutAccount:function(a,b){var c={};if(a&&a!==this.activeUser())c.Login=a;else throw Error("Can not logout. Not active account expected.");this._logoutTransport.get({params:c,complete:b})}});b.extend(b.AccountManager.prototype,{_accountInfoTransport:new b.Transport(c.settings.swaDomain+"/NaviData?mac=1&gamescnt=1",{JSONPCallbackParam:"JSONP_call",xhrEnabled:!0,requestSource:"accountInfo"}),loadAccountInfo:function(a,b){var f={};if(b=!c.settings.multiAuthEnabled?void 0:b||this.activeUser())f.Login=
b;this._accountInfoTransport.get({params:f,complete:function(b){"function"===typeof a&&a(b)},timeout:3E4})},updateAccountInfo:function(a,c){var f=+new Date;if(this._updateByTimeout||!this._updateByTimeout&&this.updateLastRequest<f-this.updateRequestTimeout||c)!this._updateByTimeout&&this.updateLastRequest&&((new Image).src="//rs.mail.ru/d"+"718344".replace("%","")+".gif?"+f),this.updateLastRequest=f,f=this.updateResume(b.bind(function(b){this._PHUpdater(b,a)},this)),this.loadAccountInfo(f)},updateRequestTimeout:6E4,
updateReset:function(a){this._updateByTimeout&&(a?(a=this.updateRequestTimeout-(new Date).getTime()+this.updateLastRequest,0>a&&(a=0)):a=this.updateRequestTimeout,b.clearTimeout(this._listAccountTimeout),this._listAccountTimeout=b.setTimeout(b.bind(this.updateAccountInfo,this),a))},updateResume:function(a){if(this._updateByTimeout){var c=this._accountInfoTransport.isProcessing();this._accountInfoTransport.cancel();this.updateReset();var f=!1;this.once("authChange",function(a,b){f=!0;"function"===
typeof b&&b()})}return b.bind(function(b){this._updateByTimeout&&(c?f?this.updateReset():this.updateAccountInfo():f?this.updateReset():this.updateReset(!0));"function"==typeof a&&a(b)},this)}});b.SCookie.removeGlobal("s_mu");b.SCookie[(b.retina?"set":"remove")+"Global"]("rt",1);b.SCookie[(b.retina?"set":"remove")+"Global"]("dpr",b.dpr);c.settings.enableUpdateRadars=b.percent(1);c.settings.authFormEnabled=c.settings.multiAuthEnabled=c.settings.portalAuthEnabled;q=!1;if(~navigator.userAgent.indexOf("Opera")&&
(!~navigator.userAgent.indexOf("Opera/9.8")||~navigator.userAgent.indexOf("Version/10"))||window.____________ie7||window.____________ie6||~navigator.userAgent.indexOf("Firefox/3."))c.settings.multiAuthEnabled=!1,c.settings.authFormEnabled=!1,q=!0;b.byId("PH_singleuser").style.display=c.settings.multiAuthEnabled?"none":"block";b.byId("PH_miltiuser").style.display=c.settings.multiAuthEnabled?"block":"none";c.settings.projectsMenuEnabled=!1;q||(c.settings.projectsMenuEnabled=!0,b.byId("PH_projectsMenu").style.display=
"inline-block",b.byId("PH_allProjects").style.display="none");c.settings.bizLinks&&(b.byId("PH_projectsMenu").style.display="none",b.byId("PH_allProjects").style.display="none");b.countEl(b.byId("PH_loginLink")||b.byId("PH_authLink"));b.countEl(b.byId("PH_logoutLink"));b.extend(c,b.EventEmitter.prototype,{cookie:z});if(~navigator.userAgent.toLowerCase().indexOf("iphone")||~navigator.userAgent.toLowerCase().indexOf("ipad")||~navigator.userAgent.toLowerCase().indexOf("ipod")||~navigator.userAgent.toLowerCase().indexOf("android"))document.body.style.cursor=
"pointer";c.cookie.s={};b.extend(c.cookie.s,{getLocal:h.getLocal,setLocal:h.setLocal,removeLocal:h.removeLocal,getGlobal:h.getGlobal,setGlobal:h.setGlobal,removeGlobal:h.removeGlobal,setProject:h.setProject});var W="mail"!==b.project;b.accountManager=new b.AccountManager({noAuthView:b.byId("PH_noAuthView"),authView:b.byId("PH_authView"),userEmail:b.byId(c.settings.multiAuthEnabled?"PH_user-email":"PH_user-email_disabled"),updateByTimeout:W});b.counters=new b.Couners({mail:"g_mail_events",my:"g_my_events",
ok:"g_ok_events",games:"g_games_events",love:"g_love_events"});c.updateCounter=function(a){"sting"===typeof a||"number"===typeof a||void 0===a||null===a?b.counters._counters[b.project]&&b.counters.update(b.project,a):b.counters.update(a);W||b.accountManager.updateAccountInfo()};"mail"==b.project&&window.jQuery&&window.jQuery(window).bind("updatemessagescount",function(a,b){c.updateCounter(b)});c.isMultiAuth=function(){return c.settings.multiAuthEnabled};c.activeUser=function(){if(c.settings.portalAuthEnabled){var a=
b.accountManager.activeUser();return null===a?b.accountManager.____user:a}return b.byId("PH_user-email_disabled").innerHTML||void 0};c.settings.portalAuthEnabled&&(c.isCorp=function(){var a=c.activeUser();return"corp.mail.ru"==(a&&a.split("@")[1])},c.switchAccount=function(a,c){b.accountManager.switchAccount(a,c)},c.logoutAccount=function(a,c){b.accountManager.logoutAccount(a,function(){b.accountManager.loadAccountsList(c)})});c.settings.multiAuthEnabled&&(c.loadAccountsList=(new b.DeferredQuery).getQuery(),
c.on("visibilitychange",function(a){!a.data.hidden&&null!==b.accountManager.activeUser()&&(b.accountManager.activeUser()?b.accountManager.switchAccount(b.accountManager.activeUser(),null,!0):b.accountManager.updateAccountInfo(function(){},!0))}));q=new b.Menu({baseClass:"x-ph__menu",orientation:"right",rootNode:b.byId("PH_authMenu"),button:b.byId("PH_authMenu_button"),openCounter:"home"==b.project?"d1126003":"mail"==b.project?"d1126002":"my"==b.project?"d1270901":"d1126005"});b.authMenu=q;c.authMenu=
new b.EventEmitter;c.settings.multiAuthEnabled&&(c.authMenu.show=b.bind(b.authMenu.show,b.authMenu),c.authMenu.hide=b.bind(b.authMenu.hide,b.authMenu));c.authForm=new b.EventEmitter;c.settings.authFormEnabled?(c.authForm.show=(new b.DeferredQuery).getQuery(),c.authForm.hide=(new b.DeferredQuery).getQuery()):(c.authForm.show=function(a){var c=[];a||(a={});a.login&&a.domain&&c.push("email="+a.login+"@"+a.domain);c.push("page="+encodeURIComponent(a.successPage?a.successPage:"mail"==b.project||"home"==
b.project?"https://e.mail.ru/messages/inbox":window.location.href));window.location="https://e.mail.ru/login?"+c.join("&")},c.authForm.hide=function(){});c.authForm.isVisible=function(){return b.authForm?b.authForm.isVisible():!1};b.authLinkClickHandler=function(a){c.listeners("loginRequest")?(b.eventPreventDefault(a),c.emit("loginRequest")):c.settings.authFormEnabled&&(b.eventPreventDefault(a),c.authForm.show())};b.event(1,b.byId("PH_authLink"),"click",b.authLinkClickHandler);b.registerLinkClickHandler=
function(a){c.listeners("registerRequest")&&(b.eventPreventDefault(a),c.authForm.hide(),c.emit("registerRequest"))};b.event(1,b.byId("PH_regLink"),"click",b.registerLinkClickHandler);c.isAuthFormEnabled=function(){return c.settings.authFormEnabled};b.projectsMenu=new b.Menu({baseClass:"x-ph__menu",rootNode:b.byId("PH_projectsMenu"),button:b.byId("PH_projectsMenu_button"),openCounter:"d582157"});if(c.settings.projectsMenuEnabled||c.settings.multiAuthEnabled||c.settings.authFormEnabled){var v=
document.createElement("script"),X=document.getElementsByTagName("head")[0];v.defer="defer";v.async="async";v.type="text/javascript";v.src=c.settings.newDesign?c.settings.externalNewJS:c.settings.externalJS;!("opera"in window)||"complete"===document.readyState?X.appendChild(v):window.addEventListener("DOMContentLoaded",function(){X.appendChild(v)},!1)}u.timeEnd("headline.inline.js")}})();
